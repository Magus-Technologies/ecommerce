<!-- Modal -->
<div class="modal fade show d-block" tabindex="-1" role="dialog" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="ph ph-gift me-2"></i>
          {{ getModalTitle() }}
        </h5>
        <button
          type="button"
          class="btn-close"
          (click)="onCancel()"
          [disabled]="loading"
        ></button>
      </div>
      
      <!-- Body -->
      <div class="modal-body">
        <form [formGroup]="recompensaForm" (ngSubmit)="onSubmit()">
          <div class="row g-16">
            <!-- Nombre -->
            <div class="col-12">
              <label class="form-label required">Nombre de la Recompensa</label>
              <input
                type="text"
                class="form-control"
                [class.is-invalid]="submitted && f['nombre'].errors"
                formControlName="nombre"
                placeholder="Ej: Programa de Fidelidad Q1 2024"
                [disabled]="loading"
              />
              <div *ngIf="submitted && f['nombre'].errors" class="invalid-feedback">
                <div *ngIf="f['nombre'].errors?.['required']">El nombre es obligatorio</div>
                <div *ngIf="f['nombre'].errors?.['maxlength']">El nombre no puede exceder 255 caracteres</div>
              </div>
            </div>
            
            <!-- Tipo -->
            <div class="col-md-6">
              <label class="form-label required">Tipo de Recompensa</label>
              <select
                class="form-select"
                [class.is-invalid]="submitted && f['tipo'].errors"
                formControlName="tipo"
                (change)="onTipoChange()"
                [disabled]="loading"
              >
                <option value="">Seleccionar tipo...</option>
                <option *ngFor="let tipo of tipos" [value]="tipo.value">
                  {{ tipo.label }}
                </option>
              </select>
              <div *ngIf="submitted && f['tipo'].errors" class="invalid-feedback">
                <div *ngIf="f['tipo'].errors?.['required']">Debe seleccionar un tipo</div>
              </div>
            </div>
            
            <!-- Estado -->
            <div class="col-md-6">
              <label class="form-label">Estado</label>
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  formControlName="activo"
                  [disabled]="loading"
                />
                <label class="form-check-label">
                  {{ recompensaForm.get('activo')?.value ? 'Activa' : 'Inactiva' }}
                </label>
              </div>
            </div>
            
            <!-- Descripción -->
            <div class="col-12">
              <label class="form-label">Descripción</label>
              <textarea
                class="form-control"
                formControlName="descripcion"
                rows="3"
                placeholder="Describe los beneficios y condiciones de esta recompensa..."
                [disabled]="loading"
              ></textarea>
              <div class="form-text">
                <i class="ph ph-info me-1"></i>
                <span *ngIf="recompensaForm.get('tipo')?.value">
                  {{ getTipoDescription(recompensaForm.get('tipo')?.value) }}
                </span>
                <span *ngIf="!recompensaForm.get('tipo')?.value">
                  Selecciona un tipo para ver la descripción sugerida
                </span>
              </div>
            </div>
            
            <!-- Fechas -->
            <div class="col-md-6">
              <label class="form-label required">Fecha de Inicio</label>
              <input
                type="date"
                class="form-control"
                [class.is-invalid]="submitted && f['fecha_inicio'].errors"
                formControlName="fecha_inicio"
                [min]="minDate"
                [disabled]="loading"
              />
              <div *ngIf="submitted && f['fecha_inicio'].errors" class="invalid-feedback">
                <div *ngIf="f['fecha_inicio'].errors?.['required']">La fecha de inicio es obligatoria</div>
              </div>
            </div>
            
            <div class="col-md-6">
              <label class="form-label required">Fecha de Fin</label>
              <input
                type="date"
                class="form-control"
                [class.is-invalid]="submitted && f['fecha_fin'].errors"
                formControlName="fecha_fin"
                [min]="minEndDate || minDate"
                [disabled]="loading"
              />
              <div *ngIf="submitted && f['fecha_fin'].errors" class="invalid-feedback">
                <div *ngIf="f['fecha_fin'].errors?.['required']">La fecha de fin es obligatoria</div>
              </div>
            </div>
          </div>
          
          <!-- Preview de la recompensa -->
          <div *ngIf="recompensaForm.get('nombre')?.value && recompensaForm.get('tipo')?.value" class="mt-24">
            <h6 class="text-muted mb-12">
              <i class="ph ph-eye me-2"></i>
              Vista Previa
            </h6>
            <div class="preview-card">
              <div class="preview-header">
                <div class="preview-icon">
                  <i [class]="'ph ' + getTipoIcon(recompensaForm.get('tipo')?.value)"></i>
                </div>
                <div class="preview-content">
                  <h6 class="preview-title">{{ recompensaForm.get('nombre')?.value }}</h6>
                  <p class="preview-type">{{ getTipoLabel(recompensaForm.get('tipo')?.value) }}</p>
                </div>
                <div class="preview-status">
                  <span [class]="'badge ' + (recompensaForm.get('activo')?.value ? 'bg-success' : 'bg-secondary')">
                    {{ recompensaForm.get('activo')?.value ? 'Activa' : 'Inactiva' }}
                  </span>
                </div>
              </div>
              <div *ngIf="recompensaForm.get('descripcion')?.value" class="preview-description">
                {{ recompensaForm.get('descripcion')?.value }}
              </div>
              <div class="preview-dates">
                <small class="text-muted">
                  <i class="ph ph-calendar me-1"></i>
                  {{ recompensaForm.get('fecha_inicio')?.value | date:'dd/MM/yyyy' }} - 
                  {{ recompensaForm.get('fecha_fin')?.value | date:'dd/MM/yyyy' }}
                </small>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <!-- Footer -->
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="loading"
        >
          <i class="ph ph-x me-2"></i>
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="onSubmit()"
          [disabled]="loading || recompensaForm.invalid"
        >
          <i *ngIf="!loading" [class]="'ph ' + (isEdit ? 'ph-check' : 'ph-plus') + ' me-2'"></i>
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          {{ getSubmitButtonText() }}
        </button>
      </div>
    </div>
  </div>
</div>
