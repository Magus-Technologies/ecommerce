<div class="modern-recompensas-container">
  <!-- ========== HEADER MODERNO ========== -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <div class="header-icon-wrapper">
          <svg class="header-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
          </svg>
        </div>
        <div>
          <h1 class="page-title">Gestión de Recompensas</h1>
          <p class="page-subtitle">Administra y configura las recompensas para tus clientes</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary-modern" (click)="crearRecompensa()">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          <span>Crear Recompensa</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ========== TARJETAS DE MÉTRICAS RÁPIDAS ========== -->
  <div class="metrics-grid" *ngIf="!loading">
    <div class="metric-card">
      <div class="metric-header">
        <div class="metric-icon bg-blue">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <span class="metric-label">Total Activas</span>
      </div>
      <div class="metric-value">{{ totalElements }}</div>
      <div class="metric-footer">
        <span class="metric-change positive">
          <svg class="metric-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z" clip-rule="evenodd" />
          </svg>
          +12% este mes
        </span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-header">
        <div class="metric-icon bg-green">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
          </svg>
        </div>
        <span class="metric-label">Clientes Alcanzados</span>
      </div>
      <div class="metric-value">{{ recompensas.reduce((sum, r) => sum + (r.total_clientes_aplicables || 0), 0) | number }}</div>
      <div class="metric-footer">
        <span class="metric-change positive">
          <svg class="metric-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z" clip-rule="evenodd" />
          </svg>
          +8% este mes
        </span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-header">
        <div class="metric-icon bg-yellow">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <span class="metric-label">Valor Total Estimado</span>
      </div>
      <div class="metric-value">{{ formatearMoneda(recompensas.reduce((sum, r) => sum + calcularValorEstimado(r), 0)) }}</div>
      <div class="metric-footer">
        <span class="metric-change positive">
          <svg class="metric-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z" clip-rule="evenodd" />
          </svg>
          +15% este mes
        </span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-header">
        <div class="metric-icon bg-purple">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
          </svg>
        </div>
        <span class="metric-label">Productos Aplicables</span>
      </div>
      <div class="metric-value">{{ recompensas.reduce((sum, r) => sum + (r.total_productos_aplicables || 0), 0) | number }}</div>
      <div class="metric-footer">
        <span class="metric-change neutral">
          <svg class="metric-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
          </svg>
          Sin cambios
        </span>
      </div>
    </div>
  </div>

  <!-- ========== FILTROS MODERNOS ========== -->
  <div class="filters-card">
    <div class="filters-header">
      <div class="filters-title">
        <svg class="filters-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
        </svg>
        <span>Filtros de Búsqueda</span>
      </div>
      <button class="btn-collapse" [class.expanded]="filtrosExpandidos" (click)="filtrosExpandidos = !filtrosExpandidos">
        <svg class="collapse-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
        </svg>
      </button>
    </div>

    <div class="filters-content" [class.collapsed]="!filtrosExpandidos">
      <div class="filters-grid">
        <!-- Búsqueda principal -->
        <div class="filter-item full-width">
          <label class="filter-label">
            <svg class="label-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
            Buscar
          </label>
          <input
            type="text"
            class="filter-input"
            placeholder="Buscar por nombre, descripción..."
            [(ngModel)]="filtros.buscar"
            (keyup)="onBuscarChange()"
            (keyup.enter)="aplicarFiltros()"
          >
        </div>

        <!-- Tipo -->
        <div class="filter-item">
          <label class="filter-label">
            <svg class="label-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
            </svg>
            Tipo
          </label>
          <select class="filter-select" [(ngModel)]="filtros.tipo" (change)="onTipoChange()">
            <option value="">Todos los tipos</option>
            <option *ngFor="let tipo of tiposRecompensa" [value]="tipo.value || tipo">
              {{ safeString(tipo) | titlecase }}
            </option>
          </select>
        </div>

        <!-- Estado -->
        <div class="filter-item">
          <label class="filter-label">
            <svg class="label-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Estado
          </label>
          <select class="filter-select" [(ngModel)]="filtros.estado" (change)="onEstadoChange()">
            <option value="">Todos los estados</option>
            <option value="activa">Activas</option>
            <option value="pausada">Pausadas</option>
            <option value="programada">Programadas</option>
            <option value="expirada">Expiradas</option>
            <option value="cancelada">Canceladas</option>
          </select>
        </div>

        <!-- Vigencia -->
        <div class="filter-item">
          <label class="filter-label">
            <svg class="label-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Vigencia
          </label>
          <select class="filter-select" [(ngModel)]="filtros.vigente" (change)="onVigenciaChange()">
            <option value="">Todas</option>
            <option [value]="true">Vigentes</option>
            <option [value]="false">Expiradas</option>
          </select>
        </div>

        <!-- Fecha Desde -->
        <div class="filter-item">
          <label class="filter-label">
            <svg class="label-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
            </svg>
            Fecha Desde
          </label>
          <input
            type="date"
            class="filter-input"
            [(ngModel)]="filtros.fecha_inicio"
            (change)="onFechaChange()"
          >
        </div>

        <!-- Fecha Hasta -->
        <div class="filter-item">
          <label class="filter-label">
            <svg class="label-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
            </svg>
            Fecha Hasta
          </label>
          <input
            type="date"
            class="filter-input"
            [(ngModel)]="filtros.fecha_fin"
            (change)="onFechaChange()"
          >
        </div>
      </div>

      <!-- Acciones de filtros -->
      <div class="filters-actions">
        <button class="btn btn-secondary-modern" (click)="limpiarFiltros()">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
          <span>Limpiar</span>
        </button>
        <button class="btn btn-primary-modern" (click)="aplicarFiltros()">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
          <span>Buscar</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ========== CHIPS DE FILTROS ACTIVOS ========== -->
  <div class="active-filters" *ngIf="tieneFiltrosActivos()">
    <div class="filters-label">Filtros activos:</div>
    <div class="chips-container">
      <div class="chip" *ngIf="filtros.buscar">
        <span class="chip-label">Búsqueda:</span>
        <span class="chip-value">"{{ filtros.buscar }}"</span>
        <button class="chip-remove" (click)="filtros.buscar = ''; aplicarFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>
      <div class="chip" *ngIf="filtros.tipo">
        <span class="chip-label">Tipo:</span>
        <span class="chip-value">{{ safeString(filtros.tipo) | titlecase }}</span>
        <button class="chip-remove" (click)="filtros.tipo = undefined; aplicarFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>
      <div class="chip" *ngIf="filtros.estado">
        <span class="chip-label">Estado:</span>
        <span class="chip-value">{{ getEstadoLabel(filtros.estado) }}</span>
        <button class="chip-remove" (click)="filtros.estado = undefined; aplicarFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>
      <div class="chip" *ngIf="filtros.fecha_inicio">
        <span class="chip-label">Desde:</span>
        <span class="chip-value">{{ filtros.fecha_inicio }}</span>
        <button class="chip-remove" (click)="filtros.fecha_inicio = ''; aplicarFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>
      <div class="chip" *ngIf="filtros.fecha_fin">
        <span class="chip-label">Hasta:</span>
        <span class="chip-value">{{ filtros.fecha_fin }}</span>
        <button class="chip-remove" (click)="filtros.fecha_fin = ''; aplicarFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        </button>
      </div>
      <button class="chip chip-clear-all" (click)="limpiarFiltros()">
        <svg class="chip-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" />
        </svg>
        <span>Limpiar todo</span>
      </button>
    </div>
  </div>

  <!-- ========== TABLA MODERNA ========== -->
  <div class="table-card">
    <div class="table-header">
      <div class="table-title-section">
        <h2 class="table-title">
          <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
          </svg>
          <span>Lista de Recompensas</span>
          <span class="table-badge">{{ totalElements }}</span>
        </h2>
      </div>
      <div class="table-controls">
        <div class="control-group">
          <span class="control-label">Mostrar:</span>
          <select class="control-select" [(ngModel)]="pageSize" (change)="cargarRecompensas()">
            <option [value]="10">10</option>
            <option [value]="25">25</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
          </select>
        </div>
        <div class="view-toggle">
          <button
            class="toggle-btn"
            [class.active]="vistaCompacta"
            (click)="cambiarVista(true)"
            title="Vista Compacta">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10zm0 5.25a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
            </svg>
          </button>
          <button
            class="toggle-btn"
            [class.active]="!vistaCompacta"
            (click)="cambiarVista(false)"
            title="Vista Expandida">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h1.148a1.5 1.5 0 011.465 1.175l.716 3.223a1.5 1.5 0 01-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 006.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 011.767-1.052l3.223.716A1.5 1.5 0 0118 15.352V16.5a1.5 1.5 0 01-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 012.43 8.326 13.019 13.019 0 012 5V3.5z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="table-container">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner">
          <svg class="spinner-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </div>
        <p class="loading-text">Cargando recompensas...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && recompensas.length === 0" class="empty-state">
        <div class="empty-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
          </svg>
        </div>
        <h3 class="empty-title">No hay recompensas</h3>
        <p class="empty-description">No se encontraron recompensas con los filtros aplicados.</p>
        <button class="btn btn-primary-modern" (click)="crearRecompensa()">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          <span>Crear Primera Recompensa</span>
        </button>
      </div>

      <!-- Tabla -->
      <table class="modern-table" *ngIf="!loading && recompensas.length > 0" [class.compact]="vistaCompacta">
        <thead>
          <tr>
            <th class="col-id">ID</th>
            <th class="col-name">Nombre</th>
            <th class="col-type">Tipo</th>
            <th class="col-status">Estado</th>
            <th class="col-date">Inicio</th>
            <th class="col-date">Fin</th>
            <th class="col-number">Clientes</th>
            <th class="col-number">Productos</th>
            <th class="col-currency">Valor</th>
            <th class="col-actions">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let recompensa of recompensas; trackBy: trackByRecompensaId" class="table-row">
            <td class="col-id">
              <span class="id-badge">#{{ recompensa.id }}</span>
            </td>
            <td class="col-name">
              <div class="name-cell">
                <span class="name-text">{{ recompensa.nombre }}</span>
                <span class="description-text" *ngIf="!vistaCompacta">{{ recompensa.descripcion }}</span>
              </div>
            </td>
            <td class="col-type">
              <span class="type-badge" [attr.data-type]="recompensa.tipo">
                <svg class="badge-icon" [innerHTML]="getTipoIconSVG(recompensa.tipo)"></svg>
                <span>{{ (recompensa.tipo || '') | titlecase }}</span>
              </span>
            </td>
            <td class="col-status">
              <span class="status-badge" [attr.data-status]="getEstadoReal(recompensa)">
                <span class="status-dot"></span>
                <span>{{ vistaCompacta ? ((getEstadoReal(recompensa) || '') | slice:0:3 | uppercase) : ((getEstadoReal(recompensa) || '') | titlecase) }}</span>
              </span>
            </td>
            <td class="col-date">
              <span class="date-text">{{ formatearFecha(recompensa.fecha_inicio) }}</span>
            </td>
            <td class="col-date">
              <span class="date-text">{{ formatearFecha(recompensa.fecha_fin) }}</span>
            </td>
            <td class="col-number">
              <span class="number-badge blue">{{ formatearNumero(recompensa.total_clientes_aplicables || 0) }}</span>
            </td>
            <td class="col-number">
              <span class="number-badge yellow">{{ formatearNumero(recompensa.total_productos_aplicables || 0) }}</span>
            </td>
            <td class="col-currency">
              <span class="currency-text">{{ formatearMoneda(calcularValorEstimado(recompensa)) }}</span>
            </td>
            <td class="col-actions">
              <div class="actions-menu">
                <button class="actions-trigger" (click)="toggleAccionesMenu(recompensa.id, $event)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" />
                  </svg>
                </button>
                <div class="actions-dropdown" *ngIf="openMenuId === recompensa.id">
                  <button class="action-item view" (click)="verDetalle(recompensa); closeAccionesMenu()">
                    <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>Ver detalle</span>
                  </button>
                  <button class="action-item edit" (click)="editarRecompensa(recompensa); closeAccionesMenu()">
                    <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                    </svg>
                    <span>Editar</span>
                  </button>
                  <button class="action-item toggle" (click)="cambiarEstadoRecompensa(recompensa); closeAccionesMenu()">
                    <svg class="action-icon" *ngIf="getEstadoReal(recompensa) === 'activa'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5" />
                    </svg>
                    <svg class="action-icon" *ngIf="getEstadoReal(recompensa) !== 'activa'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" />
                    </svg>
                    <span>{{ getEstadoReal(recompensa) === 'activa' ? 'Pausar' : 'Activar' }}</span>
                  </button>
                  <button class="action-item duplicate" (click)="duplicarRecompensa(recompensa); closeAccionesMenu()">
                    <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" />
                    </svg>
                    <span>Duplicar</span>
                  </button>
                  <div class="action-divider"></div>
                  <button class="action-item delete" (click)="eliminarRecompensa(recompensa); closeAccionesMenu()">
                    <svg class="action-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                    <span>Eliminar</span>
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación Moderna -->
    <div class="pagination-container" *ngIf="totalPages > 1 && !loading">
      <div class="pagination-info">
        Mostrando <span class="font-semibold">{{ (currentPage * pageSize) + 1 }}</span> a
        <span class="font-semibold">{{ Math.min((currentPage + 1) * pageSize, totalElements) }}</span> de
        <span class="font-semibold">{{ totalElements }}</span> resultados
      </div>
      <div class="pagination-controls">
        <button
          class="pagination-btn"
          [disabled]="currentPage === 0"
          (click)="previousPage()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
          </svg>
          <span>Anterior</span>
        </button>
        <div class="pagination-pages">
          <button
            *ngFor="let page of getPages()"
            class="page-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)">
            {{ page + 1 }}
          </button>
        </div>
        <button
          class="pagination-btn"
          [disabled]="currentPage === totalPages - 1"
          (click)="nextPage()">
          <span>Siguiente</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- ========== NOTIFICACIONES MODERNAS ========== -->
  <div class="notification-container" *ngIf="mostrarNotificacion">
    <div class="notification" [attr.data-type]="tipoNotificacion">
      <div class="notification-icon">
        <svg *ngIf="tipoNotificacion === 'success'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
        </svg>
        <svg *ngIf="tipoNotificacion === 'error'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
        </svg>
        <svg *ngIf="tipoNotificacion === 'info'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="notification-content">
        <p class="notification-message">{{ mensajeNotificacion }}</p>
      </div>
      <button class="notification-close" (click)="cerrarNotificacion()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
  </div>
</div>
