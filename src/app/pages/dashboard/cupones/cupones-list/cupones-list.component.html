 <div class="container-fluid">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-24">
        <div>
          <h4 class="text-heading fw-semibold mb-8">Cupones</h4>
          <p class="text-gray-500 mb-0">Administra los cupones de descuento</p>
        </div>
        <button class="btn bg-main-600 hover-bg-main-700 text-white px-16 py-8 rounded-8"
                data-bs-toggle="modal" 
                data-bs-target="#modalCrearCupon">
          <i class="ph ph-plus me-8"></i>
          Nuevo Cupón
        </button>
      </div>

      <!-- Tabla con ngx-datatable -->
      <div class="card border-0 shadow-sm rounded-12">
        <!-- Header de información -->
        <div class="card-header bg-white border-bottom px-24 py-16" *ngIf="!isLoading && cupones.length > 0">
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-16">
              <span class="text-sm text-gray-600">{{ selectionText }}</span>
              <div class="d-flex align-items-center gap-8" *ngIf="selected.length > 0">
                <button class="btn btn-sm btn-outline-danger px-12 py-6">
                  <i class="ph ph-trash me-4"></i>
                  Eliminar seleccionados
                </button>
              </div>
            </div>
            <div class="d-flex align-items-center gap-8">
              <span class="text-sm fw-medium text-dark">Mostrando</span>
              <select class="form-select form-select-sm border-gray-300" style="width: auto; min-width: 60px; font-size: 0.875rem; padding: 4px 8px;" [(ngModel)]="pageSize">
                <option [value]="5">5</option>
                <option [value]="10">10</option>
                <option [value]="25">25</option>
                <option [value]="50">50</option>
              </select>
              <span class="text-sm fw-medium text-dark">por página</span>
            </div>
          </div>
        </div>

        <div class="card-body p-0">
          
          <!-- Loading state -->
          <div *ngIf="isLoading" class="text-center py-40">
            <div class="spinner-border text-main-600" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="text-gray-500 mt-12 mb-0">Cargando cupones...</p>
          </div>

          <!-- Datatable -->
          <ngx-datatable
            #table
            *ngIf="!isLoading"
            class="bootstrap cupones-table"
            [columns]="columns"
            [rows]="cupones"
            [columnMode]="ColumnMode.flex"
            [headerHeight]="50"
            [footerHeight]="50"
            [rowHeight]="80"
            [limit]="pageSize"
            [scrollbarV]="false"
            [scrollbarH]="false"
            [loadingIndicator]="isLoading"
            [trackByProp]="'id'"
            [sortType]="SortType.single"
            [selectionType]="SelectionType.checkbox"
            [selected]="selected"
            [selectAllRowsOnPage]="false"
            [displayCheck]="displayCheck"
            [externalPaging]="false"
            (select)="onSelect($event)"
            (page)="onPageChange($event)"
          >
            <!-- Columna Código -->
            <ngx-datatable-column
              name="Código"
              prop="codigo"
              [flexGrow]="2.5"
              [minWidth]="150"
              [sortable]="true"
            >
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div class="d-flex align-items-center gap-12">
                  <div class="cupon-info">
                    <h6 class="cupon-title" [title]="row.codigo">{{ row.codigo }}</h6>
                    <p class="cupon-subtitle">{{ row.titulo }}</p>
                    <div *ngIf="row.solo_primera_compra" class="mt-4">
                      <span class="badge bg-info-50 text-info-600 config-badge">
                        <i class="ph ph-user me-4"></i>Solo primera compra
                      </span>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>

            <!-- Columna Descuento -->
            <ngx-datatable-column
              name="Descuento"
              prop="valor_descuento"
              [flexGrow]="1"
              [minWidth]="90"
              [sortable]="true"
            >
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div class="text-center">
                  <span class="badge bg-success-50 text-success-600 descuento-badge">
                    {{ row.tipo_descuento === 'porcentaje' ? row.valor_descuento + '%' : 'S/ ' + row.valor_descuento }}
                  </span>
                  <div class="descuento-tipo">
                    {{ row.tipo_descuento === 'porcentaje' ? 'Porcentaje' : 'Cantidad fija' }}
                  </div>
                  <div *ngIf="row.compra_minima" class="descuento-tipo">
                    Mín: S/ {{ row.compra_minima }}
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>

            <!-- Columna Fechas -->
            <ngx-datatable-column
              name="Vigencia"
              prop="fecha_inicio"
              [flexGrow]="1.5"
              [minWidth]="120"
              [sortable]="true"
            >
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div class="fechas-info">
                  <div class="fecha-item">
                    <strong>Inicio:</strong> {{ formatDate(row.fecha_inicio) }}
                  </div>
                  <div class="fecha-item">
                    <strong>Fin:</strong> {{ formatDate(row.fecha_fin) }}
                  </div>
                  <span class="badge fecha-estado-badge"
                        [class]="getEstadoFecha(row).class">
                    {{ getEstadoFecha(row).texto }}
                  </span>
                </div>
              </ng-template>
            </ngx-datatable-column>

            <!-- Columna Usos -->
            <ngx-datatable-column
              name="Usos"
              [flexGrow]="1"
              [minWidth]="80"
              [sortable]="false"
            >
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div class="text-center">
                  <div class="uso-info">
                    <strong>{{ row.usos_actuales || 0 }}</strong>
                    <span *ngIf="row.limite_uso">/ {{ row.limite_uso }}</span>
                    <span *ngIf="!row.limite_uso">/ ∞</span>
                  </div>
                  <div class="uso-tipo">
                    {{ row.limite_uso ? 'Limitado' : 'Ilimitado' }}
                  </div>
                  <div *ngIf="row.limite_uso" class="progress-container">
                    <div class="progress" style="height: 4px;">
                      <div class="progress-bar bg-main-600" 
                           [style.width.%]="((row.usos_actuales || 0) / row.limite_uso) * 100">
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>

            <!-- Columna Estado -->
            <ngx-datatable-column
              name="Estado"
              prop="activo"
              [flexGrow]="0.8"
              [minWidth]="70"
              [sortable]="true"
            >
              <ng-template let-row="row" ngx-datatable-cell-template>
                <span class="badge estado-badge"
                      [class]="row.activo ? 'bg-success-50 text-success-600' : 'bg-danger-50 text-danger-600'">
                  {{ row.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </ng-template>
            </ngx-datatable-column>

            <!-- Columna Acciones -->
            <ngx-datatable-column
              name="Acciones"
              [flexGrow]="1.2"
              [minWidth]="150"
              [sortable]="false"
              [canAutoResize]="false"
            >
              <ng-template let-row="row" ngx-datatable-cell-template>
                <div class="action-buttons">
                  <!-- Copiar código -->
                  <button class="btn action-btn copy-btn"
                          title="Copiar código"
                          (click)="copiarCodigo(row.codigo)">
                    <i class="ph ph-copy"></i>
                  </button>

                  <!-- Editar -->
                  <button class="btn action-btn edit-btn"
                          title="Editar"
                          (click)="editarCupon(row)">
                    <i class="ph ph-pencil"></i>
                  </button>

                  <!-- Eliminar -->
                  <button class="btn action-btn delete-btn"
                          title="Eliminar"
                          (click)="eliminarCupon(row.id!)">
                    <i class="ph ph-trash"></i>
                  </button>
                </div>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>

          <!-- Empty state -->
          <div *ngIf="!isLoading && cupones.length === 0" class="text-center py-40">
            <i class="ph ph-ticket text-gray-300 text-6xl mb-16"></i>
            <h6 class="text-heading fw-semibold mb-8">No hay cupones</h6>
            <p class="text-gray-500 mb-16">Aún no has creado ningún cupón</p>
            <button class="btn bg-main-600 hover-bg-main-700 text-white px-16 py-8 rounded-8"
                    data-bs-toggle="modal" 
                    data-bs-target="#modalCrearCupon">
              <i class="ph ph-plus me-8"></i>
              Crear primer cupón
            </button>
          </div>
        </div>
      </div>

      <!-- Modal para crear/editar cupón -->
      <app-cupon-modal 
        [cupon]="cuponSeleccionado"
        (cuponGuardado)="onCuponGuardado()"
        (modalCerrado)="onModalCerrado()">
      </app-cupon-modal>
    </div>