<!-- src/app/pages/index/index.component.html -->
<!-- ============================ Banner Section Start =============================== -->
<div class="banner w-100 p-0">
  <div
    class="banner-item position-relative overflow-hidden w-100"
    style="padding: 0; margin: 0"
  >

    <!-- ✅ SIN IMAGEN DE FONDO - Solo banners dinámicos -->

    <!-- ✅ BOTONES DE NAVEGACIÓN CON ESTILOS CORRECTOS -->
    <button
      type="button"
      id="banner-prev"
      class="banner-nav-btn flex-center rounded-circle box-shadow-4xl bg-white text-xl text-main-600 hover-bg-main-600 hover-text-white transition-1"
      (click)="anteriorSlide()"
    >
      <i class="ph ph-caret-left"></i>
    </button>
    <button
      type="button"
      id="banner-next"
      class="banner-nav-btn flex-center rounded-circle box-shadow-4xl bg-white text-xl text-main-600 hover-bg-main-600 hover-text-white transition-1"
      (click)="siguienteSlide()"
    >
      <i class="ph ph-caret-right"></i>
    </button>

    <!-- ✅ BANNERS DINÁMICOS -->
    <ngx-slick-carousel
      class="carousel"
      #slickModal="slick-carousel"
      [config]="slideConfig"
      (init)="slickInit($event)"
      (breakpoint)="breakpoint($event)"
      (afterChange)="afterChange($event)"
      (beforeChange)="beforeChange($event)"
    >
      <!-- Estado de carga -->
      <div ngxSlickItem *ngIf="isLoadingBanners" class="slide">
        <div class="w-100" style="height: 450px">
          <div
            class="w-100 h-100 d-flex align-items-center justify-content-center"
          >
            <div class="placeholder-glow w-100 h-100">
              <span class="placeholder col-12 h-100"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ BANNERS ESTILO MERCADO LIBRE - Solo imagen clickeable -->
      <div ngxSlickItem *ngFor="let banner of bannersDinamicos" class="slide">
        <div class="w-100 banner-responsive-container">
          <!-- ✅ BANNER OCUPA TODO EL ESPACIO DISPONIBLE -->
          <a
            [routerLink]="[banner.enlace_url]"
            class="d-block w-100 h-100 position-relative overflow-hidden banner-link"
            style="transition: transform 0.3s ease, box-shadow 0.3s ease"
            (mouseenter)="onBannerHover($event, true)"
            (mouseleave)="onBannerHover($event, false)"
          >
            <img
              [src]="
                banner.imagen_url || 'assets/images/banner-placeholder.jpg'
              "
              [alt]="'Banner ' + banner.orden"
              (error)="onImageError($event)"
              class="w-100 h-100 banner-responsive-img"
              style="
                object-fit: cover;
                object-position: center;
                transition: transform 0.3s ease;
              "
            />

            <!-- Overlay hover sutil -->
            <div
              class="banner-overlay position-absolute top-0 start-0 w-100 h-100"
              style="
                background: rgba(0, 0, 0, 0);
                transition: background 0.3s ease;
                pointer-events: none;
              "
            ></div>
          </a>
        </div>
      </div>

      <!-- Mensaje cuando no hay banners dinámicos -->
      <div
        ngxSlickItem
        *ngIf="!isLoadingBanners && bannersDinamicos.length === 0"
        class="slide"
      >
        <div
          class="w-100 d-flex align-items-center justify-content-center"
          style="
            height: 450px;
            background: linear-gradient(
              135deg,
              var(--main-600) 0%,
              var(--main-800) 100%
            );
          "
        >
          <div class="text-center text-white px-4">
            <span
              class="d-inline-block bg-white bg-opacity-20 backdrop-blur px-16 py-8 rounded-pill text-sm fw-semibold mb-16"
            >
              Descuento por apertura
            </span>
            <h1
              class="fw-bold mb-24"
              style="font-size: 2.5rem; line-height: 1.2"
            >
              Pedidos en la tienda en tecnología con descuentos
            </h1>
            <a
              [routerLink]="['shop']"
              class="btn btn-light d-inline-flex align-items-center rounded-pill gap-8 px-24 py-12 fw-semibold"
            >
              Ir a la tienda
              <span class="icon text-xl d-flex">
                <i class="ph ph-shopping-cart-simple"></i>
              </span>
            </a>
          </div>
        </div>
      </div>
    </ngx-slick-carousel>
  </div>
</div>
<!-- ============================ Banner Section End =============================== -->
 
<!-- ============================ Inicio de la sección de funciones =============================== -->
<div
  class="feature"
  id="featureSection"

>
  <div class="container container-lg" style="padding-top: 0">
    <div
      class="position-relative arrow-center"
      style="padding-top: 0; margin-top: 0"
    >
      <div class="flex-align">
        <button
          type="button"
          id="feature-item-wrapper-prev"
          class="slick-prev slick-arrow flex-center rounded-circle bg-white text-xl hover-bg-main-600 hover-text-white transition-1"
        >
          <svg width="16" height="16" viewBox="0 0 256 256" fill="none">
            <path
              d="M168.49 199.51a12 12 0 0 1-17 17l-80-80a12 12 0 0 1 0-17l80-80a12 12 0 0 1 17 17L97 128Z"
              fill="currentColor"
            />
          </svg>
        </button>
        <button
          type="button"
          id="feature-item-wrapper-next"
          class="slick-next slick-arrow flex-center rounded-circle bg-white text-xl hover-bg-main-600 hover-text-white transition-1"
        >
          <svg width="16" height="16" viewBox="0 0 256 256" fill="none">
            <path
              d="M87.51 56.49a12 12 0 0 1 17-17l80 80a12 12 0 0 1 0 17l-80 80a12 12 0 0 1-17-17L159 128Z"
              fill="currentColor"
            />
          </svg>
        </button>
      </div>

      <!-- ✅ ESTADO DE CARGA PARA CATEGORÍAS -->
      <div *ngIf="isLoadingCategorias" class="text-center py-40">
        <div class="spinner-border text-main-600" role="status">
          <span class="visually-hidden">Cargando categorías...</span>
        </div>
        <p class="text-gray-500 mt-12 mb-0">Cargando categorías...</p>
      </div>

      <!-- ✅ CATEGORÍAS DINÁMICAS -->
      <ngx-slick-carousel
        *ngIf="!isLoadingCategorias && featureItems.length > 0"
        class="feature-item-wrapper"
        #slickModal="slick-carousel"
        [config]="featureSlideConfig"
      >
        <div
          ngxSlickItem
          *ngFor="let item of featureItems"
          class="feature-item text-center"
          style="
            padding-top: 0;
            margin-top: 0;
            transform: translate3d(0px, 10px, 0px);
          "
        >
          <div
            class="feature-item__thumb rounded-circle"
            style="
              border: 2px solid white;
              background: linear-gradient(to top, #1c799b, white);
              padding: 4px;
              transition: all 0.3s ease;
              position: relative;
              overflow: hidden;
              width: 140px;
              height: 140px;
              margin: 0 auto;
              z-index: 10;
            "
            onmouseover="this.style.transform='scale(1.05)'; this.style.filter='brightness(1.1)'"
            onmouseout="this.style.transform='scale(1)'; this.style.filter='brightness(1)'"
          >
            <a
              [routerLink]="getCategoriaLink(item)"
              class="w-100 h-100 flex-center"
              style="
                border-radius: 50%;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                background: white;
              "
            >
              <img
                [src]="item.img"
                [alt]="item.title"
                (error)="onImageError($event)"
                style="
                  border: none;
                  outline: none;
                  box-shadow: none;
                  margin: 0;
                  padding: 0;
                  display: block;
                  width: 100%;
                  height: 100%;
                  object-fit: cover;
                "
              />
            </a>
          </div>
          <div class="feature-item__content mt-16">
            <h6 class="text-lg mb-8">
              <a
                [routerLink]="getCategoriaLink(item)"
                class="text-inherit"
                >{{ item.title }}</a
              >
            </h6>
            <span class="text-sm text-gray-400">
              {{ item.productos_count || 0
              }}{{ item.productos_count === 1 ? " Producto" : "+ Productos" }}
            </span>
          </div>
        </div>
      </ngx-slick-carousel>

      <!-- ✅ MENSAJE CUANDO NO HAY CATEGORÍAS -->
      <div
        *ngIf="!isLoadingCategorias && featureItems.length === 0"
        class="text-center py-40"
      >
        <div class="bg-gray-50 rounded-12 py-30 px-20">
          <i class="ph ph-squares-four text-4xl text-gray-300 mb-16"></i>
          <h6 class="text-gray-500 mb-8 fw-semibold">
            No hay categorías disponibles
          </h6>
          <p class="text-gray-400 text-sm mb-16">
            Actualmente no hay categorías configuradas en la tienda
          </p>
          <a
            [routerLink]="['shop']"
            class="btn btn-sm bg-main-600 text-white px-16 py-8 rounded-8"
          >
            <i class="ph ph-storefront me-8"></i>
            Ver todos los productos
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ============================ Feature Section End =============================== -->
<section class="promotional-banner pt-80">
  <div class="container container-lg">
    <!-- Loading state -->
    <div *ngIf="isLoadingPromotionalBanners" class="row gy-4">
      <div class="col-xl-3 col-sm-6 col-xs-6" *ngFor="let i of [1, 2, 3, 4]">
        <div
          class="promotional-banner-item position-relative rounded-24 overflow-hidden z-1 py-52 ps-40 pe-24 h-100"
        >
          <div class="placeholder-glow">
            <span class="placeholder col-8 mb-16" style="height: 24px"></span>
            <span class="placeholder col-6 mb-16" style="height: 20px"></span>
            <span class="placeholder col-4" style="height: 32px"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Banners dinámicos -->
    <div *ngIf="!isLoadingPromotionalBanners" class="row gy-4">
      <div
        class="col-xl-3 col-sm-6 col-xs-6 wow bounceIn"
        *ngFor="let banner of promotionalBanners"
        [attr.data-aos]="'fade-up'"
        [attr.data-aos-duration]="banner.animacion_delay"
      >
        <!-- Reemplázala con: -->
        <div
          class="promotional-banner-item position-relative rounded-24 overflow-hidden z-1 py-52 ps-40 pe-24 h-100"
          [style.background-color]="banner.color_fondo || '#ffffff'"
        >
          <img
            [src]="
              banner.imagen_url ||
              'assets/images/thumbs/promotional-banner-default.png'
            "
            [alt]="banner.titulo"
            class="position-absolute inset-block-start-0 inset-inline-start-0 w-100 h-100 object-fit-cover z-n1"
            (error)="onImageError($event)"
          />
          <div class="promotional-banner-item__content">
            <h6
              class="promotional-banner-item__title text-2xl max-w-184"
              [style.color]="banner.color_texto || '#212529'"
            >
              {{ banner.titulo }}
            </h6>

            <div *ngIf="banner.precio" class="d-flex align-items-end gap-8">
              <span
                class="fst-italic text-sm fw-bold text-white"
                style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7)"
                >Desde</span
              >
              <h6 class="text-danger-600 mb-0 text-xl">{{ banner.precio }}</h6>
            </div>

            <a
              [href]="getSafeUrl(banner.enlace_url)"
              class="d-inline-flex align-items-center rounded-pill gap-8 mt-24 px-16 py-8 text-decoration-none"
              [style.background-color]="banner.color_boton || '#0d6efd'"
              [style.color]="'#ffffff'"
              [style.border]="'1px solid ' + (banner.color_boton || '#0d6efd')"
            >
              {{ banner.texto_boton || "Compra ahora" }}
              <span class="icon text-xl d-flex">
                <i class="ph ph-arrow-right"></i>
              </span>
            </a>
          </div>
        </div>
      </div>

      <!-- Fallback si no hay banners -->
      <div
        *ngIf="promotionalBanners.length === 0"
        class="col-12 text-center py-40"
      >
        <p class="text-gray-500">No hay banners promocionales disponibles</p>
      </div>
    </div>
  </div>
</section>

<!-- ========================= flash sales Start (DINÁMICO) ================================ -->
<section class="flash-sales pt-80 overflow-hidden">
  <div class="container container-lg">
    <div class="section-heading mb-40">
      <h5 class="mb-0">Ventas Flash</h5>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoadingOfertas" class="text-center py-40">
      <div class="spinner-border text-main-600" role="status">
        <span class="visually-hidden">Cargando flash sales...</span>
      </div>
    </div>

    <!-- Flash Sales dinámicos -->
    <div
      *ngIf="!isLoadingOfertas && flashSalesActivas.length > 0"
      class="row gy-4 arrow-style-two"
    >
      <div
        class="col-lg-6"
        *ngFor="let sale of flashSalesActivas; let i = index"
        [attr.data-aos]="'fade-up'"
        [attr.data-aos-duration]="600 + i * 200"
      >
        <div
          class="flash-sales-item rounded-16 overflow-hidden z-1 position-relative flex-align flex-0 justify-content-between gap-8 ps-56-px"
          [style.backgroundColor]="sale.color_fondo || '#f8f9fa'"
        >
          <img
            [src]="
              sale.banner_imagen_url || 'assets/images/bg/flash-sale-bg1.png'
            "
            [alt]="sale.titulo"
            class="position-absolute inset-block-start-0 inset-inline-start-0 w-100 h-100 object-fit-cover z-n1 flash-sales-item__bg"
            (error)="onImageError($event)"
          />

          <div
            class="flash-sales-item__content"
            [ngClass]="i % 2 === 0 ? '' : 'ms-sm-auto'"
          >
            <h6 class="text-32 mb-8">{{ sale.titulo }}</h6>
            <p class="text-neutral-500 mb-12">
              {{
                sale.descripcion ||
                  "Tiempo restante hasta el final de la oferta."
              }}
            </p>

            <div class="countdown mb-16" [id]="'countdown-flash-' + sale.id">
              <ul class="countdown-list flex-align flex-wrap">
                <li
                  class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5"
                  [ngClass]="
                    i % 2 === 0
                      ? 'bg-white text-dark'
                      : 'bg-main-600 text-white'
                  "
                >
                  <span class="days">0</span> D
                </li>
                <li
                  class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5"
                  [ngClass]="
                    i % 2 === 0
                      ? 'bg-white text-dark'
                      : 'bg-main-600 text-white'
                  "
                >
                  <span class="hours">0</span> H
                </li>
                <li
                  class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5"
                  [ngClass]="
                    i % 2 === 0
                      ? 'bg-white text-dark'
                      : 'bg-main-600 text-white'
                  "
                >
                  <span class="minutes">0</span> M
                </li>
                <li
                  class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5"
                  [ngClass]="
                    i % 2 === 0
                      ? 'bg-white text-dark'
                      : 'bg-main-600 text-white'
                  "
                >
                  <span class="seconds">0</span> S
                </li>
              </ul>
            </div>

            <a
              [routerLink]="[sale.enlace_url]"
              [ngClass]="
                i % 2 === 0
                  ? 'btn btn-main d-inline-flex align-items-center rounded-pill gap-8 mt-24'
                  : 'btn bg-success-600 hover-bg-success-700 d-inline-flex align-items-center rounded-pill gap-8 mt-24'
              "
            >
              {{ sale.texto_boton || "Compra ahora" }}
              <span class="icon text-xl d-flex">
                <i class="ph ph-arrow-right"></i>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Fallback si no hay flash sales -->
    <div
      *ngIf="!isLoadingOfertas && flashSalesActivas.length === 0"
      class="text-center py-40"
    >
      <h6 class="text-gray-500 mb-20">No hay flash sales disponibles</h6>
      <a [routerLink]="['shop']" class="btn btn-main"> Explorar Productos </a>
    </div>
  </div>
</section>
<!-- ========================= flash sales End ================================ -->

<!-- Resto del contenido permanece igual... -->
<section class="recommended overflow-hidden pt-80">
  <div class="container container-lg">
    <div class="section-heading flex-between flex-wrap gap-16">
      <h5 class="mb-0 wow fadeInLeft">Recomendado para ti</h5>
      <ul
        class="nav common-tab nav-pills wow fadeInRight"
        id="pills-tab"
        role="tablist"
      >
        <li class="nav-item" role="presentation">
          <button
            class="nav-link fw-medium text-sm border border-white hover-border-main-600"
            [class.active]="categoriaSeleccionada === null"
            (click)="filtrarPorCategoria(null)"
            type="button"
            role="tab"
          >
            Todo
          </button>
        </li>
        <li
          class="nav-item"
          role="presentation"
          *ngFor="let categoria of categoriasParaFiltro; let i = index"
        >
          <button
            class="nav-link fw-medium text-sm border border-white hover-border-main-600"
            [class.active]="categoriaSeleccionada === categoria.id"
            (click)="filtrarPorCategoria(categoria.id)"
            type="button"
            role="tab"
          >
            {{ categoria.nombre }}
          </button>
        </li>
      </ul>
    </div>

    <div class="tab-content" id="pills-tabContent">
      <div
        class="tab-pane fade show active"
        id="pills-all"
        role="tabpanel"
        aria-labelledby="pills-all-tab"
        tabindex="0"
      >
        <!-- ✅ LOADING STATE PARA PRODUCTOS RECOMENDADOS -->
        <div *ngIf="isLoadingProductosFiltrados" class="text-center py-40">
          <div class="spinner-border text-main-600" role="status">
            <span class="visually-hidden">Cargando productos...</span>
            >
          </div>
          <p class="text-gray-500 mt-12 mb-0">Cargando productos...</p>
        </div>

        <!-- ✅ PRODUCTOS RECOMENDADOS DINÁMICOS -->
        <div class="row g-12">
          <!-- Productos dinámicos -->
          <div
            *ngFor="let product of productosFiltrados"
            class="col-xxl-2 col-lg-3 col-sm-4 col-6"
            data-aos="fade-up"
            data-aos-duration="200"
          >
            <div
              class="product-card h-100 p-12 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2 group-item"
            >
              <button
                type="button"
                class="wishlist-btn-custom"
                [class.active]="isInWishlist(product.id)"
                (click)="agregarAWishlist(product)"
              >
                <!-- Corazón vacío (cuando no está en wishlist) -->
                <svg
                  *ngIf="!isInWishlist(product.id)"
                  width="20"
                  height="20"
                  viewBox="0 0 256 256"
                  fill="none"
                  class="heart-icon"
                >
                  <path
                    d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"
                    fill="currentColor"
                  />
                </svg>

                <!-- Corazón con solo el borde (cuando está en wishlist) -->
                <svg
                  *ngIf="isInWishlist(product.id)"
                  width="20"
                  height="20"
                  viewBox="0 0 256 256"
                  fill="none"
                  class="heart-icon heart-outline"
                >
                  <path
                    d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"
                    stroke="currentColor"
                    stroke-width="16"
                    fill="none"
                  />
                </svg>
              </button>

              <span
                *ngIf="product.is_on_sale"
                class="product-card__badge bg-danger-600 px-8 py-4 text-sm text-white"
              >
                Sale {{ product.discount_percentage }}%
              </span>
              <a
                [routerLink]="getProductLink(product)"
                class="product-card__thumb flex-center overflow-hidden"
              >
                <img
                  [src]="product.imagen_principal"
                  [alt]="product.nombre"
                  (error)="onImageError($event)"
                />
              </a>
              <div class="product-card__content p-sm-2 w-100">
                <h6 class="title text-lg fw-semibold my-12">
                  <a
                    [routerLink]="getProductLink(product)"
                    class="link text-line-2"
                    >{{ product.nombre }}</a
                  >
                </h6>
                <div class="flex-align gap-4">
                  <span class="text-main-600 text-md d-flex"
                    ><i class="ph-fill ph-storefront"></i
                  ></span>
                  <span class="text-gray-500 text-xs"
                    >By {{ product.marca || "Tienda" }}</span
                  >
                </div>

                <div class="product-card__content mt-12">
                  <div class="product-card__price mb-8">
                    <span class="text-heading text-md fw-semibold"
                      >S/ {{ product.precio_oferta || product.precio }}
                      <span class="text-gray-500 fw-normal">/Qty</span>
                    </span>
                    <span
                      *ngIf="product.precio_oferta && product.precio"
                      class="text-gray-400 text-md fw-semibold text-decoration-line-through"
                      >S/ {{ product.precio }}</span
                    >
                  </div>
                  <div class="flex-align gap-6">
                    <span class="text-xs fw-bold text-gray-600">{{
                      product.rating || 4.8
                    }}</span>
                    <span class="text-15 fw-bold text-warning-600 d-flex"
                      ><i class="ph-fill ph-star"></i
                    ></span>
                    <span class="text-xs fw-bold text-gray-600"
                      >({{ product.reviews_count || "17" }}k)</span
                    >
                  </div>
                  <!-- ✅ BOTÓN MEJORADO PARA AGREGAR AL CARRITO -->
                  <button
                    (click)="addToCart(product)"
                    class="product-card__cart btn bg-main-50 text-main-600 hover-bg-main-600 hover-text-white py-11 px-24 rounded-pill flex-align gap-8 mt-24 w-100 justify-content-center"
                  >
                    Agregar al carrito <i class="ph ph-shopping-cart"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ✅ MENSAJE CUANDO NO HAY PRODUCTOS RECOMENDADOS -->
        <div
          *ngIf="
            !isLoadingProductosFiltrados && productosFiltrados.length === 0
          "
          class="text-center py-40"
        >
          <h6 class="text-gray-500 mb-20">
            No hay productos disponibles{{
              categoriaSeleccionada ? " en esta categoría" : ""
            }}
          </h6>

          <a [routerLink]="['shop']" class="btn btn-main">
            Explorar Productos
          </a>
        </div>
      </div>
      <!-- Repetir para las demás pestañas con el mismo botón mejorado -->
    </div>
  </div>
</section>

<!-- ========================= OFERTAS ESPECIALES DE HOY (CON PRODUCTOS DINÁMICOS) ================================ -->
<section class="hot-deals pt-80 overflow-hidden">
  <div class="container container-lg">
    <div class="section-heading">
      <div class="flex-between flex-wrap gap-8">
        <h5 class="mb-0 wow fadeInLeft">Ofertas especiales de hoy</h5>
        <div class="flex-align gap-16 wow fadeInRight">
          <a
            [routerLink]="['shop']"
            class="text-sm fw-medium text-gray-700 hover-text-main-600 hover-text-decoration-underline"
            >Ver Todas las ofertas</a
          >
          <div class="flex-align gap-8">
            <button
              type="button"
              id="deals-prev"
              class="slick-prev slick-arrow flex-center rounded-circle border border-gray-100 hover-border-main-600 text-xl hover-bg-main-600 hover-text-white transition-1"
            >
              <i class="ph ph-caret-left"></i>
            </button>
            <button
              type="button"
              id="deals-next"
              class="slick-next slick-arrow flex-center rounded-circle border border-gray-100 hover-border-main-600 text-xl hover-bg-main-600 hover-text-white transition-1"
            >
              <i class="ph ph-caret-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-12">
      <div class="col-md-4" data-aos="zoom-in">
        <!-- ✅ SECCIÓN PRINCIPAL DE OFERTA DEL DÍA CON DATOS DINÁMICOS -->
        <div
          class="hot-deals position-relative rounded-16 bg-main-600 overflow-hidden ps-40 pe-24 pt-80 pb-120 z-1"
        >
          <img
            src="assets/images/shape/offer-shape.png"
            alt=""
            class="position-absolute inset-block-start-0 inset-inline-start-0 z-n1 w-100 h-100 opacity-6"
          />

          <!-- ✅ MOSTRAR IMAGEN SOLO SI HAY OFERTA CON IMAGEN -->
          <img
            *ngIf="ofertaPrincipalDelDia?.oferta_principal?.imagen_url"
            [src]="ofertaPrincipalDelDia!.oferta_principal!.imagen_url"
            [alt]="ofertaPrincipalDelDia!.oferta_principal!.titulo"
            class="position-absolute inset-inline-end-0 inset-block-end-0"
            style="max-height: 100%; max-width: 50%; object-fit: contain; object-position: bottom right;"
          />

          <!-- ✅ CONTENIDO DINÁMICO DE LA OFERTA PRINCIPAL CON VERIFICACIONES DE NULL -->
          <div
            *ngIf="
              !isLoadingOfertaPrincipal &&
              ofertaPrincipalDelDia &&
              ofertaPrincipalDelDia.oferta_principal
            "
          >
            <span
              class="text-primary-600 bg-yellow text-heading py-4 px-12 rounded-4 text-sm fw-medium"
              >Ofertas especiales</span
            >
            <div class="">
              <h5 class="text-white mb-8 mt-12">
                {{ ofertaPrincipalDelDia.oferta_principal.titulo }}
              </h5>
              <p class="fw-semibold text-success-600">
                {{
                  ofertaPrincipalDelDia.oferta_principal.subtitulo ||
                    "Ahorra hasta " +
                      ofertaPrincipalDelDia.oferta_principal.valor_descuento +
                      (ofertaPrincipalDelDia.oferta_principal.tipo_descuento ===
                      "porcentaje"
                        ? "%"
                        : " soles") +
                      " en tu compra"
                }}
              </p>
              <div
                class="countdown mt-24 mb-24"
                id="countdown-oferta-principal"
              >
                <ul class="countdown-list d-flex align-items-center flex-wrap">
                  <li
                    class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium colon-white"
                  >
                    <span class="days">0</span> D
                  </li>
                  <li
                    class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium colon-white"
                  >
                    <span class="hours">0</span> H
                  </li>
                  <li
                    class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium colon-white"
                  >
                    <span class="minutes">0</span> M
                  </li>
                  <li
                    class="countdown-list__item py-8 px-12 text-heading flex-align gap-4 text-sm fw-medium colon-white"
                  >
                    <span class="seconds">0</span> S
                  </li>
                </ul>
              </div>
              <a
                [routerLink]="[
                  ofertaPrincipalDelDia.oferta_principal.enlace_url || 'shop'
                ]"
                class="mt-16 btn bg-white hover-text-white hover-bg-main-800 text-main-600 fw-medium d-inline-flex align-items-center rounded-pill gap-8"
                tabindex="0"
              >
                {{
                  ofertaPrincipalDelDia.oferta_principal.texto_boton ||
                    "Explorar Tienda"
                }}
                <span class="icon text-xl d-flex"
                  ><i class="ph-bold ph-shopping-cart"></i
                ></span>
              </a>
            </div>
          </div>

          <!-- ✅ FALLBACK CUANDO NO HAY OFERTA PRINCIPAL -->
          <div
            *ngIf="
              !isLoadingOfertaPrincipal &&
              (!ofertaPrincipalDelDia ||
                !ofertaPrincipalDelDia.oferta_principal)
            "
            class="text-center py-40"
          >
            <div class="bg-white bg-opacity-10 rounded-12 py-30 px-20">
              <i class="ph ph-tag text-4xl text-white mb-16"></i>
              <h5 class="text-white mb-8 fw-semibold">
                No hay ofertas especiales disponibles
              </h5>
              <p class="text-white text-opacity-75 text-sm mb-16">
                Actualmente no tenemos ofertas especiales del día activas
              </p>
              <a
                [routerLink]="['shop']"
                class="btn bg-white text-main-600 hover-bg-main-100 px-24 py-10 rounded-pill d-inline-flex align-items-center gap-8"
              >
                <i class="ph ph-storefront"></i>
                Explorar productos
              </a>
            </div>
          </div>

          <!-- ✅ LOADING STATE PARA OFERTA PRINCIPAL -->
          <div *ngIf="isLoadingOfertaPrincipal" class="text-center">
            <div class="spinner-border text-white" role="status">
              <span class="visually-hidden">Cargando oferta principal...</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <!-- ✅ PRODUCTOS DE LA OFERTA PRINCIPAL DINÁMICOS -->
        <div *ngIf="isLoadingOfertaPrincipal" class="text-center py-40">
          <div class="spinner-border text-main-600" role="status">
            <span class="visually-hidden"
              >Cargando productos de la oferta principal...</span
            >
          </div>
        </div>

        <!-- ✅ PRODUCTOS DE LA OFERTA PRINCIPAL CON VERIFICACIONES DE NULL -->
        <ngx-slick-carousel
          *ngIf="
            !isLoadingOfertaPrincipal &&
            ofertaPrincipalDelDia &&
            ofertaPrincipalDelDia.productos &&
            ofertaPrincipalDelDia.productos.length > 0
          "
          #slickModal="slick-carousel"
          class="product-one-slider g-12"
          [config]="hotDealsSlideConfig"
        >
          <div
            ngxSlickItem
            *ngFor="let producto of ofertaPrincipalDelDia.productos"
            class="slide"
          >
            <div
              class=""
              [attr.data-aos]="'fade-up'"
              [attr.data-aos-duration]="200"
            >
              <div
                class="product-card px-20 py-16 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2"
              >
                <!-- Badge de descuento -->
                <span
                  class="product-card__badge bg-danger-600 px-8 py-4 text-sm text-white position-absolute inset-block-start-0 inset-inline-start-0 ms-16 mt-16"
                >
                  -{{ producto.descuento_porcentaje }}%
                </span>

                <!-- ✅ BOTÓN MEJORADO PARA AGREGAR AL CARRITO -->
                <button
                  (click)="addToCart(producto)"
                  class="product-card__cart btn bg-main-50 text-main-600 hover-bg-main-600 hover-text-white py-11 px-24 rounded-pill flex-align gap-8 position-absolute inset-block-start-0 inset-inline-end-0 me-16 mt-16"
                >
                  <i class="ph ph-shopping-cart me-4"></i>
                  Agregar
                </button>

                <a
                  [routerLink]="getProductLink(producto)"
                  class="product-card__thumb flex-center overflow-hidden"
                >
                  <img
                    [src]="
                      producto.imagen_url ||
                      'assets/images/thumbs/product-default.png'
                    "
                    [alt]="producto.nombre"
                    (error)="onImageError($event)"
                  />
                </a>

                <div class="product-card__content mt-12">
                  <div
                    class="product-card__price mb-8 d-flex align-items-center gap-8"
                  >
                    <span class="text-heading text-md fw-semibold"
                      >S/ {{ producto.precio_oferta | number : "1.2-2" }}
                      <span class="text-gray-500 fw-normal">/Qty</span></span
                    >
                    <span
                      class="text-gray-400 text-md fw-semibold text-decoration-line-through"
                      >S/
                      {{ producto.precio_original | number : "1.2-2" }}</span
                    >
                  </div>

                  <div class="flex-align gap-6">
                    <span class="text-xs fw-bold text-gray-600">4.8</span>
                    <span class="text-15 fw-bold text-warning-600 d-flex"
                      ><i class="ph-fill ph-star"></i
                    ></span>
                    <span class="text-xs fw-bold text-gray-600">(17k)</span>
                  </div>

                  <h6 class="title text-lg fw-semibold mt-12 mb-20">
                    <a
                      [routerLink]="getProductLink(producto)"
                      class="link text-line-2"
                      >{{ producto.nombre }}</a
                    >
                  </h6>

                  <!-- Barra de progreso de stock -->
                  <div class="mt-12" *ngIf="producto.stock_oferta">
                    <div
                      class="progress w-100 bg-color-three rounded-pill h-4"
                      role="progressbar"
                      [attr.aria-valuenow]="
                        (producto.vendidos_oferta / producto.stock_oferta) * 100
                      "
                      aria-valuemin="0"
                      aria-valuemax="100"
                    >
                      <div
                        class="progress-bar bg-main-600 rounded-pill"
                        [style.width.%]="
                          (producto.vendidos_oferta / producto.stock_oferta) *
                          100
                        "
                      ></div>
                    </div>
                    <span class="text-gray-900 text-xs fw-medium mt-8 d-block">
                      Vendidos: {{ producto.vendidos_oferta }}/{{
                        producto.stock_oferta
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ngx-slick-carousel>

        <!-- ✅ FALLBACK: PRODUCTOS EN OFERTA GENERALES SI NO HAY OFERTA PRINCIPAL -->
        <ngx-slick-carousel
          *ngIf="
            !isLoadingOfertaPrincipal &&
            (!ofertaPrincipalDelDia ||
              !ofertaPrincipalDelDia.productos ||
              ofertaPrincipalDelDia.productos.length === 0) &&
            productosEnOferta.length > 0
          "
          #slickModal="slick-carousel"
          class="product-one-slider g-12"
          [config]="hotDealsSlideConfig"
        >
          <div
            ngxSlickItem
            *ngFor="let producto of productosEnOferta"
            class="slide"
          >
            <div
              class=""
              [attr.data-aos]="'fade-up'"
              [attr.data-aos-duration]="200"
            >
              <div
                class="product-card px-20 py-16 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2"
              >
                <!-- Badge de descuento -->
                <span
                  class="product-card__badge bg-danger-600 px-8 py-4 text-sm text-white position-absolute inset-block-start-0 inset-inline-start-0 ms-16 mt-16"
                >
                  -{{ producto.descuento_porcentaje }}%
                </span>

                <!-- ✅ BOTÓN MEJORADO PARA AGREGAR AL CARRITO -->
                <button
                  (click)="addToCart(producto)"
                  class="product-card__cart btn bg-main-50 text-main-600 hover-bg-main-600 hover-text-white py-11 px-24 rounded-pill flex-align gap-8 position-absolute inset-block-start-0 inset-inline-end-0 me-16 mt-16"
                >
                  <i class="ph ph-shopping-cart me-4"></i>
                  Agregar
                </button>

                <a
                  [routerLink]="getProductLink(producto)"
                  class="product-card__thumb flex-center overflow-hidden"
                >
                  <img
                    [src]="
                      producto.imagen_url ||
                      'assets/images/thumbs/product-default.png'
                    "
                    [alt]="producto.nombre"
                    (error)="onImageError($event)"
                  />
                </a>

                <div class="product-card__content mt-12">
                  <div
                    class="product-card__price mb-8 d-flex align-items-center gap-8"
                  >
                    <span class="text-heading text-md fw-semibold"
                      >S/ {{ producto.precio_oferta | number : "1.2-2" }}
                      <span class="text-gray-500 fw-normal">/Qty</span></span
                    >
                    <span
                      class="text-gray-400 text-md fw-semibold text-decoration-line-through"
                      >S/
                      {{ producto.precio_original | number : "1.2-2" }}</span
                    >
                  </div>

                  <div class="flex-align gap-6">
                    <span class="text-xs fw-bold text-gray-600">4.8</span>
                    <span class="text-15 fw-bold text-warning-600 d-flex"
                      ><i class="ph-fill ph-star"></i
                    ></span>
                    <span class="text-xs fw-bold text-gray-600">(17k)</span>
                  </div>

                  <h6 class="title text-lg fw-semibold mt-12 mb-20">
                    <a
                      [routerLink]="getProductLink(producto)"
                      class="link text-line-2"
                      >{{ producto.nombre }}</a
                    >
                  </h6>

                  <!-- Barra de progreso de stock -->
                  <div class="mt-12" *ngIf="producto.stock_oferta">
                    <div
                      class="progress w-100 bg-color-three rounded-pill h-4"
                      role="progressbar"
                      [attr.aria-valuenow]="
                        (producto.vendidos_oferta / producto.stock_oferta) * 100
                      "
                      aria-valuemin="0"
                      aria-valuemax="100"
                    >
                      <div
                        class="progress-bar bg-main-600 rounded-pill"
                        [style.width.%]="
                          (producto.vendidos_oferta / producto.stock_oferta) *
                          100
                        "
                      ></div>
                    </div>
                    <span class="text-gray-900 text-xs fw-medium mt-8 d-block">
                      Vendidos: {{ producto.vendidos_oferta }}/{{
                        producto.stock_oferta
                      }}
                    </span>
                  </div>

                  <!-- Countdown si es flash sale -->
                  <div
                    *ngIf="producto.es_flash_sale"
                    class="countdown mt-12"
                    [id]="'countdown-producto-' + producto.id"
                  >
                    <ul class="countdown-list flex-align flex-wrap">
                      <li
                        class="countdown-list__item py-4 px-8 text-heading flex-align gap-2 text-xs fw-medium box-shadow-2xl rounded-4 bg-danger-600 text-white"
                      >
                        <span class="days">0</span> D
                      </li>
                      <li
                        class="countdown-list__item py-4 px-8 text-heading flex-align gap-2 text-xs fw-medium box-shadow-2xl rounded-4 bg-danger-600 text-white"
                      >
                        <span class="hours">0</span> H
                      </li>
                      <li
                        class="countdown-list__item py-4 px-8 text-heading flex-align gap-2 text-xs fw-medium box-shadow-2xl rounded-4 bg-danger-600 text-white"
                      >
                        <span class="minutes">0</span> M
                      </li>
                      <li
                        class="countdown-list__item py-4 px-8 text-heading flex-align gap-2 text-xs fw-medium box-shadow-2xl rounded-4 bg-danger-600 text-white"
                      >
                        <span class="seconds">0</span> S
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ngx-slick-carousel>

        <!-- Fallback si no hay productos en oferta -->
        <div
          *ngIf="
            !isLoadingOfertaPrincipal &&
            (!ofertaPrincipalDelDia ||
              !ofertaPrincipalDelDia.productos ||
              ofertaPrincipalDelDia.productos.length === 0) &&
            productosEnOferta.length === 0
          "
          class="text-center py-40"
        >
          <h6 class="text-gray-500 mb-20">
            No hay productos en oferta disponibles
          </h6>
          <a [routerLink]="['shop']" class="btn btn-main">
            Explorar Productos
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- ========================= hot-deals End ================================ -->

<!-- ✅ SECCIÓN DE CUPONES DINÁMICOS -->
<div class="pt-80">
  <div class="container container-lg">
    <!-- Loading cupones -->
    <div *ngIf="isLoadingCupones" class="text-center py-20">
      <div class="spinner-border text-main-600" role="status">
        <span class="visually-hidden">Cargando cupones...</span>
      </div>
    </div>

    <!-- Cupones dinámicos -->
    <div
      *ngIf="!isLoadingCupones && cuponesActivos && cuponesActivos.length > 0"
      class="row gy-4"
    >
      <div *ngFor="let cupon of cuponesActivos; let i = index" class="col-12">
        <div
          class="border border-main-500 bg-main-50 border-dashed rounded-8 py-20 d-flex align-items-center justify-content-between px-20"
        >
          <div class="flex-grow-1">
            <h6 class="text-main-600 fw-bold mb-8">{{ cupon.titulo }}</h6>
            <p class="h6 text-main-600 fw-normal mb-8">
              <span class="fw-bold">
                {{
                  cupon.tipo_descuento === "porcentaje"
                    ? cupon.valor_descuento + "% OFF"
                    : "S/ " + cupon.valor_descuento + " OFF"
                }}
              </span>
            </p>
            <p
              class="text-sm text-main-600 fw-normal mb-0"
              *ngIf="cupon.compra_minima"
            >
              Compra mínima:
              <span class="fw-bold"
                >S/ {{ cupon.compra_minima | number : "1.2-2" }}</span
              >
            </p>
          </div>

          <div class="position-relative">
            <button
              class="copy-coupon-btn px-24 py-10 text-white text-uppercase bg-main-600 rounded-pill border-0 hover-bg-main-800"
              (click)="copiarCupon(cupon.codigo)"
            >
              {{ cupon.codigo }}
              <i class="ph ph-copy text-lg line-height-1 ms-2"></i>
            </button>
            <span
              class="copy-text bg-main-600 text-white fw-normal position-absolute px-16 py-6 rounded-pill bottom-100 start-50 translate-middle-x min-w-max mb-8 text-xs d-none"
              [id]="'copy-text-' + i"
            >
              ¡Copiado!
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje cuando no hay cupones -->
    <div
      *ngIf="
        !isLoadingCupones && (!cuponesActivos || cuponesActivos.length === 0)
      "
      class="text-center py-40"
    >
      <div class="bg-gray-100 rounded-8 py-20 px-30">
        <i class="ph ph-ticket text-4xl text-gray-400 mb-16"></i>
        <h6 class="text-gray-500 mb-8">No hay cupones disponibles</h6>
        <p class="text-gray-400 text-sm mb-0">
          Mantente atento a nuestras próximas ofertas y descuentos especiales
        </p>
      </div>
    </div>
  </div>
</div>
<!-- SUPER CUPON DE DESCUENTO Discount End -->

<!-- ========================== START productos, destacados,ofertas, mas vendidos ============================== -->
<div class="short-product pt-110">
  <div class="container container-lg">
    <div class="row gy-4">
      <div
        class="col-xxl-3 col-lg-4 col-sm-6"
        data-aos="fade-up"
        data-aos-duration="600"
      >
        <div
          class="p-16 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2"
        >
          <div class="p-16 bg-main-50 rounded-16 mb-32">
            <h6
              class="underlined-line position-relative mb-0 pb-16 d-inline-block"
            >
              Productos destacados
            </h6>
          </div>

          <!-- ✅ ESTADO DE CARGA -->
          <div *ngIf="isLoadingProductosDestacados" class="text-center py-40">
            <div class="spinner-border text-main-600" role="status">
              <span class="visually-hidden"
                >Cargando productos destacados...</span
              >
            </div>
            <p class="text-gray-500 mt-12 mb-0 text-sm">
              Cargando productos destacados...
            </p>
          </div>

          <!-- ✅ PRODUCTOS DESTACADOS DINÁMICOS -->
          <div
            *ngIf="
              !isLoadingProductosDestacados && productosDestacados.length > 0
            "
            class="short-product-list arrow-style-two max-h-unset"
          >
            <ngx-slick-carousel
              #slickModal="slick-carousel"
              class="short-product-list arrow-style-two max-h-unset"
              [config]="sortProductSlideConfig"
            >
              <!-- ✅ PRIMER SLIDE CON PRODUCTOS DESTACADOS -->
              <div ngxSlickItem class="d-flex flex-column gap-44">
                <div
                  *ngFor="let product of productosDestacados.slice(0, 4)"
                  class="flex-align gap-16"
                >
                  <div
                    class="w-90 h-90 rounded-12 border border-gray-100 flex-shrink-0"
                  >
                    <a
                      [routerLink]="getProductLink(product)"
                      class="link"
                    >
                      <img
                        [src]="
                          product.imagen_principal ||
                          'assets/images/thumbs/short-product-img1.png'
                        "
                        [alt]="product.nombre"
                        (error)="onImageError($event)"
                        style="
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                          border-radius: 8px;
                        "
                      />
                    </a>
                  </div>
                  <div class="product-card__content mt-12">
                    <div class="flex-align gap-6">
                      <span class="text-xs fw-bold text-gray-500">{{
                        product.rating || 4.8
                      }}</span>
                      <span class="text-15 fw-bold text-warning-600 d-flex">
                        <i class="ph-fill ph-star"></i>
                      </span>
                      <span class="text-xs fw-bold text-gray-500"
                        >({{
                          product.reviews_count ||
                            product.total_reviews ||
                            "17k"
                        }})</span
                      >
                    </div>
                    <h6 class="title text-lg fw-semibold mt-8 mb-8">
                      <a
                        [routerLink]="getProductLink(product)"
                        class="link text-line-1"
                        [title]="product.nombre"
                        >{{ product.nombre }}</a
                      >
                    </h6>
                    <div class="product-card__price flex-align gap-8">
                      <span class="text-heading text-md fw-semibold d-block">
                        S/ {{ product.precio | number : "1.2-2" }}
                      </span>
                      <span
                        *ngIf="
                          product.precio_oferta &&
                          product.precio_oferta < product.precio
                        "
                        class="text-gray-400 text-sm fw-normal text-decoration-line-through"
                      >
                        S/ {{ product.precio_oferta | number : "1.2-2" }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ✅ SEGUNDO SLIDE SI HAY MÁS DE 4 PRODUCTOS -->
              <div
                ngxSlickItem
                *ngIf="productosDestacados.length > 4"
                class="d-flex flex-column gap-44"
              >
                <div
                  *ngFor="let product of productosDestacados.slice(4, 8)"
                  class="flex-align gap-16"
                >
                  <div
                    class="w-90 h-90 rounded-12 border border-gray-100 flex-shrink-0"
                  >
                    <a
                      [routerLink]="getProductLink(product)"
                      class="link"
                    >
                      <img
                        [src]="
                          product.imagen_principal ||
                          'assets/images/thumbs/short-product-img1.png'
                        "
                        [alt]="product.nombre"
                        (error)="onImageError($event)"
                        style="
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                          border-radius: 8px;
                        "
                      />
                    </a>
                  </div>
                  <div class="product-card__content mt-12">
                    <div class="flex-align gap-6">
                      <span class="text-xs fw-bold text-gray-500">{{
                        product.rating || 4.8
                      }}</span>
                      <span class="text-15 fw-bold text-warning-600 d-flex">
                        <i class="ph-fill ph-star"></i>
                      </span>
                      <span class="text-xs fw-bold text-gray-500"
                        >({{
                          product.reviews_count ||
                            product.total_reviews ||
                            "17k"
                        }})</span
                      >
                    </div>
                    <h6 class="title text-lg fw-semibold mt-8 mb-8">
                      <a
                        [routerLink]="getProductLink(product)"
                        class="link text-line-1"
                        [title]="product.nombre"
                        >{{ product.nombre }}</a
                      >
                    </h6>
                    <div class="product-card__price flex-align gap-8">
                      <span class="text-heading text-md fw-semibold d-block">
                        S/ {{ product.precio | number : "1.2-2" }}
                      </span>
                      <span
                        *ngIf="
                          product.precio_oferta &&
                          product.precio_oferta < product.precio
                        "
                        class="text-gray-400 text-sm fw-normal text-decoration-line-through"
                      >
                        S/ {{ product.precio_oferta | number : "1.2-2" }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </ngx-slick-carousel>
          </div>

          <!-- ✅ MENSAJE CUANDO NO HAY PRODUCTOS DESTACADOS -->
          <div
            *ngIf="
              !isLoadingProductosDestacados && productosDestacados.length === 0
            "
            class="text-center py-40"
          >
            <div class="bg-gray-50 rounded-12 py-30 px-20">
              <i class="ph ph-star text-4xl text-gray-300 mb-16"></i>
              <h6 class="text-gray-500 mb-8 fw-semibold">
                No hay productos destacados
              </h6>
              <p class="text-gray-400 text-sm mb-16">
                Aún no se han marcado productos como destacados
              </p>
              <a
                [routerLink]="['shop']"
                class="btn btn-sm bg-main-600 text-white px-16 py-8 rounded-8"
              >
                <i class="ph ph-storefront me-8"></i>
                Ver todos los productos
              </a>
            </div>
          </div>
        </div>
      </div>
      <div
        class="col-xxl-3 col-lg-4 col-sm-6"
        data-aos="fade-up"
        data-aos-duration="700"
      >
        <div
          class="p-16 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2"
        >
          <div class="p-16 bg-main-50 rounded-16 mb-32">
            <h6
              class="underlined-line position-relative mb-0 pb-16 d-inline-block"
            >
              Productos destacados
            </h6>
          </div>

          <!-- ✅ ESTADO DE CARGA -->
          <div *ngIf="isLoadingProductosMasVendidos" class="text-center py-40">
            <div class="spinner-border text-main-600" role="status">
              <span class="visually-hidden"
                >Cargando productos más vendidos...</span
              >
            </div>
            <p class="text-gray-500 mt-12 mb-0 text-sm">
              Cargando productos destacados...
            </p>
          </div>

          <!-- ✅ PRODUCTOS MÁS VENDIDOS DINÁMICOS -->
          <div
            *ngIf="
              !isLoadingProductosMasVendidos && productosMasVendidos.length > 0
            "
            class="short-product-list arrow-style-two max-h-unset"
          >
            <ngx-slick-carousel
              #slickModal="slick-carousel"
              class="short-product-list arrow-style-two max-h-unset"
              [config]="sortProductSlideConfig"
            >
              <!-- ✅ PRIMER SLIDE CON PRODUCTOS MÁS VENDIDOS -->
              <div ngxSlickItem class="d-flex flex-column gap-44">
                <div
                  *ngFor="let product of productosMasVendidos.slice(0, 4)"
                  class="flex-align gap-16"
                >
                  <div
                    class="w-90 h-90 rounded-12 border border-gray-100 flex-shrink-0"
                  >
                    <a
                      [routerLink]="getProductLink(product)"
                      class="link"
                    >
                      <img
                        [src]="
                          product.imagen_principal ||
                          'assets/images/thumbs/short-product-img1.png'
                        "
                        [alt]="product.nombre"
                        (error)="onImageError($event)"
                        style="
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                          border-radius: 8px;
                        "
                      />
                    </a>
                  </div>
                  <div class="product-card__content mt-12">
                    <div class="flex-align gap-6">
                      <span class="text-xs fw-bold text-gray-500">{{
                        product.rating || 4.8
                      }}</span>
                      <span class="text-15 fw-bold text-warning-600 d-flex">
                        <i class="ph-fill ph-star"></i>
                      </span>
                      <span class="text-xs fw-bold text-gray-500"
                        >({{
                          product.reviews_count ||
                            product.total_reviews ||
                            "17k"
                        }})</span
                      >
                    </div>
                    <h6 class="title text-lg fw-semibold mt-8 mb-8">
                      <a
                        [routerLink]="getProductLink(product)"
                        class="link text-line-1"
                        [title]="product.nombre"
                        >{{ product.nombre }}</a
                      >
                    </h6>
                    <div class="product-card__price flex-align gap-8">
                      <span class="text-heading text-md fw-semibold d-block">
                        S/ {{ product.precio | number : "1.2-2" }}
                      </span>
                      <span
                        *ngIf="
                          product.precio_oferta &&
                          product.precio_oferta < product.precio
                        "
                        class="text-gray-400 text-sm fw-normal text-decoration-line-through"
                      >
                        S/ {{ product.precio_oferta | number : "1.2-2" }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ✅ SEGUNDO SLIDE SI HAY MÁS DE 4 PRODUCTOS -->
              <div
                ngxSlickItem
                *ngIf="productosMasVendidos.length > 4"
                class="d-flex flex-column gap-44"
              >
                <div
                  *ngFor="let product of productosMasVendidos.slice(4, 8)"
                  class="flex-align gap-16"
                >
                  <div
                    class="w-90 h-90 rounded-12 border border-gray-100 flex-shrink-0"
                  >
                    <a
                      [routerLink]="getProductLink(product)"
                      class="link"
                    >
                      <img
                        [src]="
                          product.imagen_principal ||
                          'assets/images/thumbs/short-product-img1.png'
                        "
                        [alt]="product.nombre"
                        (error)="onImageError($event)"
                        style="
                          width: 100%;
                          height: 100%;
                          object-fit: cover;
                          border-radius: 8px;
                        "
                      />
                    </a>
                  </div>
                  <div class="product-card__content mt-12">
                    <div class="flex-align gap-6">
                      <span class="text-xs fw-bold text-gray-500">{{
                        product.rating || 4.8
                      }}</span>
                      <span class="text-15 fw-bold text-warning-600 d-flex">
                        <i class="ph-fill ph-star"></i>
                      </span>
                      <span class="text-xs fw-bold text-gray-500"
                        >({{
                          product.reviews_count ||
                            product.total_reviews ||
                            "17k"
                        }})</span
                      >
                    </div>
                    <h6 class="title text-lg fw-semibold mt-8 mb-8">
                      <a
                        [routerLink]="getProductLink(product)"
                        class="link text-line-1"
                        [title]="product.nombre"
                        >{{ product.nombre }}</a
                      >
                    </h6>
                    <div class="product-card__price flex-align gap-8">
                      <span class="text-heading text-md fw-semibold d-block">
                        S/ {{ product.precio | number : "1.2-2" }}
                      </span>
                      <span
                        *ngIf="
                          product.precio_oferta &&
                          product.precio_oferta < product.precio
                        "
                        class="text-gray-400 text-sm fw-normal text-decoration-line-through"
                      >
                        S/ {{ product.precio_oferta | number : "1.2-2" }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </ngx-slick-carousel>
          </div>

          <!-- ✅ MENSAJE CUANDO NO HAY PRODUCTOS MÁS VENDIDOS -->
          <div
            *ngIf="
              !isLoadingProductosMasVendidos &&
              productosMasVendidos.length === 0
            "
            class="text-center py-40"
          >
            <div class="bg-gray-50 rounded-12 py-30 px-20">
              <i class="ph ph-star text-4xl text-gray-300 mb-16"></i>
              <h6 class="text-gray-500 mb-8 fw-semibold">
                No hay productos destacados
              </h6>
              <p class="text-gray-400 text-sm mb-16">
                Aún no se han marcado productos como destacados
              </p>
              <a
                [routerLink]="['shop']"
                class="btn btn-sm bg-main-600 text-white px-16 py-8 rounded-8"
              >
                <i class="ph ph-storefront me-8"></i>
                Ver todos los productos
              </a>
            </div>
          </div>
        </div>
      </div>
      <div
        class="col-xxl-3 col-lg-4 col-sm-6"
        data-aos="fade-up"
        data-aos-duration="800"
      >
        <div
          class="p-16 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2"
        >
          <div class="p-16 bg-main-50 rounded-16 mb-32">
            <h6
              class="underlined-line position-relative mb-0 pb-16 d-inline-block"
            >
              Productos en oferta
            </h6>
          </div>
          <div class="short-product-list arrow-style-two max-h-unset">
            <!-- ✅ PRODUCTOS EN OFERTA DINÁMICOS -->
            <div
              *ngIf="productosEnOferta.length > 0"
              class="d-flex flex-column gap-44"
            >
              <div
                *ngFor="let producto of productosEnOferta.slice(0, 4)"
                class="flex-align gap-16"
              >
                <div
                  class="w-90 h-90 rounded-12 border border-gray-100 flex-shrink-0"
                >
                  <a [routerLink]="getProductLink(producto)" class="link">
                    <img
                      [src]="
                        producto.imagen_url ||
                        'assets/images/thumbs/short-product-img9.png'
                      "
                      [alt]="producto.nombre"
                      (error)="onImageError($event)"
                      style="
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        border-radius: 8px;
                      "
                    />
                  </a>
                </div>
                <div class="product-card__content mt-12">
                  <div class="flex-align gap-6">
                    <span class="text-xs fw-bold text-gray-500">4.8</span>
                    <span class="text-15 fw-bold text-warning-600 d-flex">
                      <i class="ph-fill ph-star"></i>
                    </span>
                    <span class="text-xs fw-bold text-gray-500">(17k)</span>
                  </div>
                  <h6 class="title text-lg fw-semibold mt-8 mb-8">
                    <a
                      [routerLink]="getProductLink(producto)"
                      class="link text-line-1"
                      >{{ producto.nombre }}</a
                    >
                  </h6>
                  <div class="product-card__price flex-align gap-8">
                    <span class="text-heading text-md fw-semibold d-block">
                      S/ {{ producto.precio_oferta | number : "1.2-2" }}
                    </span>
                    <span
                      class="text-gray-400 text-md fw-semibold d-block text-decoration-line-through"
                    >
                      S/ {{ producto.precio_original | number : "1.2-2" }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- ✅ MENSAJE CUANDO NO HAY PRODUCTOS EN OFERTA -->
            <div
              *ngIf="productosEnOferta.length === 0"
              class="text-center py-40"
            >
              <div class="bg-gray-50 rounded-12 py-30 px-20">
                <i class="ph ph-tag text-4xl text-gray-300 mb-16"></i>
                <h6 class="text-gray-500 mb-8 fw-semibold">
                  No hay productos en oferta
                </h6>
                <p class="text-gray-400 text-sm mb-16">
                  Actualmente no tenemos productos con descuentos especiales
                </p>
                <a
                  [routerLink]="['shop']"
                  class="btn btn-sm bg-main-600 text-white px-16 py-8 rounded-8"
                >
                  <i class="ph ph-storefront me-8"></i>
                  Ver todos los productos
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="col-xxl-3 col-lg-4 col-sm-6"
        data-aos="fade-up"
        data-aos-duration="900"
      >
        <!-- ✅ LOADING STATE PARA OFERTA DE LA SEMANA -->
        <div *ngIf="isLoadingOfertaSemana" class="text-center py-40">
          <div class="spinner-border text-main-600" role="status">
            <span class="visually-hidden">Cargando oferta de la semana...</span>
          </div>
        </div>

        <!-- ✅ OFERTA DE LA SEMANA DINÁMICA -->
        <div
          *ngIf="
            !isLoadingOfertaSemana &&
            ofertaSemanaActiva &&
            ofertaSemanaActiva.oferta_semana
          "
          class="product-card h-100 p-24 pt-32 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2 group-item pt-32"
        >
          <button type="button" class="wishlist-btn-two">
            <i class="ph-bold ph-heart"></i>
          </button>

          <div class="">
            <h6 class="position-relative mb-0 pb-12 d-inline-block">
              {{ ofertaSemanaActiva.oferta_semana.titulo }}
            </h6>
            <div class="countdown mb-10" id="countdown-oferta-semana">
              <ul class="countdown-list flex-align flex-wrap">
                <li
                  class="countdown-list__item colon-red py-8 px-12 flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5 bg-main-600 text-white"
                >
                  <span class="days">0</span> D
                </li>
                <li
                  class="countdown-list__item colon-red py-8 px-12 flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5 bg-main-600 text-white"
                >
                  <span class="hours">0</span> H
                </li>
                <li
                  class="countdown-list__item colon-red py-8 px-12 flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5 bg-main-600 text-white"
                >
                  <span class="minutes">0</span> M
                </li>
                <li
                  class="countdown-list__item colon-red py-8 px-12 flex-align gap-4 text-sm fw-medium box-shadow-4xl rounded-5 bg-main-600 text-white"
                >
                  <span class="seconds">0</span> S
                </li>
              </ul>
            </div>
            <p class="text-neutral-300 fw-medium text-sm">
              {{
                ofertaSemanaActiva.oferta_semana.subtitulo ||
                  "No te pierdas esta oportunidad especial"
              }}
            </p>
          </div>

          <!-- ✅ MOSTRAR IMAGEN DE LA OFERTA EN LUGAR DEL PRODUCTO -->
          <div class="product-card__thumb flex-center overflow-hidden">
            <img
              [src]="
                ofertaSemanaActiva.oferta_semana.imagen_url ||
                'assets/images/thumbs/product-img32.png'
              "
              [alt]="ofertaSemanaActiva.oferta_semana.titulo"
              (error)="onImageError($event)"
              style="max-width: 200px; max-height: 200px; object-fit: contain"
            />
          </div>

          <div class="product-card__content w-100">
            <!-- ✅ RATING GENÉRICO PARA LA OFERTA -->
            <div class="flex-align gap-4">
              <div class="flex-align gap-2 me-4">
                <span class="text-12 fw-medium text-warning-600 d-flex"
                  ><i class="ph-fill ph-star"></i
                ></span>
                <span class="text-12 fw-medium text-warning-600 d-flex"
                  ><i class="ph-fill ph-star"></i
                ></span>
                <span class="text-12 fw-medium text-warning-600 d-flex"
                  ><i class="ph-fill ph-star"></i
                ></span>
                <span class="text-12 fw-medium text-warning-600 d-flex"
                  ><i class="ph-fill ph-star"></i
                ></span>
                <span class="text-12 fw-medium text-warning-600 d-flex"
                  ><i class="ph-fill ph-star"></i
                ></span>
              </div>
              <span class="text-xs fw-medium text-heading"
                >(Oferta especial)</span
              >
            </div>

            <!-- ✅ MOSTRAR DESCUENTO DE LA OFERTA -->
            <div class="d-flex align-items-center gap-12 mt-6">
              <h6 class="text-danger-600 mb-0 text-lg">
                {{
                  ofertaSemanaActiva.oferta_semana.tipo_descuento ===
                  "porcentaje"
                    ? ofertaSemanaActiva.oferta_semana.valor_descuento + "% OFF"
                    : "S/ " +
                      ofertaSemanaActiva.oferta_semana.valor_descuento +
                      " OFF"
                }}
              </h6>
            </div>

            <h6 class="title text-md fw-semibold mt-10 mb-0">
              <span class="fw-bold">{{
                ofertaSemanaActiva.oferta_semana.titulo
              }}</span>
            </h6>

            <p
              class="text-gray-500 text-sm mt-12 pb-12 border-bottom border-neutral-100 mb-8"
            >
              {{
                ofertaSemanaActiva.oferta_semana.descripcion ||
                  "Oferta especial de la semana"
              }}
            </p>

            <!-- ✅ BARRA DE PROGRESO GENÉRICA O OCULTA -->
            <div
              class="progress w-100 bg-gray-100 rounded-pill h-8 mb-3"
              role="progressbar"
            >
              <div
                class="progress-bar bg-success-600 rounded-pill"
                style="width: 75%"
              ></div>
            </div>
            <div class="d-flex align-items-center gap-6">
              <span class="text-sm text-gray-500">¡Oferta limitada!</span>
            </div>

            <!-- ✅ BOTÓN QUE REDIRIJA A LA TIENDA O URL ESPECÍFICA -->
            <a
              [routerLink]="[
                ofertaSemanaActiva.oferta_semana.enlace_url || '/shop'
              ]"
              class="product-card__cart btn bg-success-600 text-white hover-bg-success-700 hover-text-white py-11 px-24 rounded-pill flex-align gap-8 mt-16 w-100 justify-content-center"
            >
              {{
                ofertaSemanaActiva.oferta_semana.texto_boton || "Ver Ofertas"
              }}
              <i class="ph ph-arrow-right"></i>
            </a>
          </div>
        </div>

        <!-- ✅ FALLBACK CUANDO NO HAY OFERTA DE LA SEMANA -->
        <div
          *ngIf="
            !isLoadingOfertaSemana &&
            (!ofertaSemanaActiva || !ofertaSemanaActiva.oferta_semana)
          "
          class="product-card h-100 p-24 pt-32 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2 group-item pt-32"
        >
          <div class="text-center py-40">
            <div class="bg-gray-50 rounded-12 py-30 px-20">
              <i class="ph ph-calendar-star text-4xl text-gray-300 mb-16"></i>
              <h6 class="text-gray-500 mb-8 fw-semibold">
                No hay oferta de la semana
              </h6>
              <p class="text-gray-400 text-sm mb-16">
                Actualmente no tenemos una oferta especial de la semana
              </p>
              <a
                [routerLink]="['shop']"
                class="btn btn-sm bg-main-600 text-white px-16 py-8 rounded-8"
              >
                <i class="ph ph-storefront me-8"></i>
                Ver todos los productos
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ============================== Brand Section Start =============================== -->
<div class="brand py-80 overflow-hidden">
  <div class="container container-lg">
    <div class="brand-inner p-24 rounded-16">
      <div class="section-heading">
        <div class="flex-between flex-wrap gap-8">
          <h5 class="mb-0 wow fadeInLeft">Comprar por marcas</h5>
          <div class="flex-align gap-16 wow fadeInRight">
            <a
              [routerLink]="['shop']"
              class="text-sm fw-medium text-gray-700 hover-text-main-600 hover-text-decoration-underline"
              >Ver todas las ofertas</a
            >
            <div class="flex-align gap-8">
              <button
                type="button"
                id="brand-prev"
                class="slick-prev slick-arrow flex-center rounded-circle border border-gray-100 hover-border-main-600 text-xl hover-bg-main-600 hover-text-white transition-1"
              >
                <i class="ph ph-caret-left"></i>
              </button>
              <button
                type="button"
                id="brand-next"
                class="slick-next slick-arrow flex-center rounded-circle border border-gray-100 hover-border-main-600 text-xl hover-bg-main-600 hover-text-white transition-1"
              >
                <i class="ph ph-caret-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="isLoadingMarcas" class="text-center py-40">
        <div class="spinner-border text-main-600" role="status">
          <span class="visually-hidden">Cargando marcas...</span>
        </div>
        <p class="text-gray-500 mt-12 mb-0">Cargando marcas...</p>
      </div>

      <ngx-slick-carousel
        *ngIf="!isLoadingMarcas && brandSlides[0].slides.length > 0"
        [config]="BrandSlideConfig"
        class="brand-slider arrow-style-two"
      >
        <div
          ngxSlickItem
          *ngFor="let slide of brandSlides[0].slides"
          class="brand-item"
          [attr.data-aos]="slide.dataAos"
          [attr.data-aos-duration]="slide.dataAosDuration"
        >
          <img
            [src]="slide.imgSrc"
            [alt]="slide.imgAlt"
            (error)="onImageError($event)"
            class="img-fluid"
          />
        </div>
      </ngx-slick-carousel>

      <div
        *ngIf="!isLoadingMarcas && brandSlides[0].slides.length === 0"
        class="text-center py-40"
      >
        <h6 class="text-gray-500 mb-20">No hay marcas disponibles</h6>
        <a [routerLink]="['shop']" class="btn btn-main"> Explorar Productos </a>
      </div>
    </div>
  </div>
</div>
<!-- ============================== Brand Section End =============================== -->

<!-- ✅ CHATBOT COMPONENT -->
<app-chatbot></app-chatbot>

<!-- ✅ WHATSAPP FLOAT COMPONENT -->
<app-whatsapp-float></app-whatsapp-float>
