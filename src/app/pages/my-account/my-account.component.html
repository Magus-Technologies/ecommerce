<!-- src\app\pages\my-account\my-account.component.html -->
<!-- ========================= Breadcrumb Start =============================== -->
<div class="breadcrumb py-26 bg-main-50">
  <div class="container container-lg">
    <div class="breadcrumb-wrapper flex-between flex-wrap gap-16">
      <h6 class="mb-0">Mi cuenta</h6>
      <ul class="flex-align gap-8 flex-wrap">
        <li class="text-sm">
          <a routerLink="/" class="text-gray-900 flex-align gap-8 hover-text-main-600">
            <i class="ph ph-house"></i>
            Inicio
          </a>
        </li>
        <li class="flex-align">
          <i class="ph ph-caret-right"></i>
        </li>
        <li class="text-sm text-main-600">Mi cuenta</li>
      </ul>
    </div>
  </div>
</div>
<!-- ========================= Breadcrumb End =============================== -->

<!-- Loading State -->
<div *ngIf="isLoading" class="d-flex justify-content-center align-items-center py-80">
  <div class="spinner-border text-main-600" role="status">
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>

<!-- ========================= My Account Section Start =============================== -->
<div *ngIf="!isLoading && currentUser" class="my-account-area py-80">
  <div class="container container-lg">
    <div class="row gy-4">
      <!-- ✅ BARRA LATERAL IZQUIERDA MEJORADA -->
      <div class="col-lg-3">
        <!-- ✅ Tarjeta de información del usuario -->
        <div class="border border-gray-100 hover-border-main-600 rounded-16 overflow-hidden bg-white mb-24 text-center transition-2">
          <div class="p-32">
            <!-- Avatar dinámico -->
            <div class="w-80 h-80 bg-main-50 text-main-600 rounded-circle flex-center mx-auto mb-16 fw-bold text-xl">
              {{ getUserInitials() }}
            </div>
            <!-- Nombre dinámico -->
            <h5 class="mb-8 text-heading">Hola, {{ getUserName() }}</h5>
            <!-- Email del usuario -->
            <p class="text-sm text-gray-600 mb-12">{{ getUserEmail() }}</p>
            <!-- Tipo de usuario dinámico -->
            <span class="text-sm px-12 py-4 rounded-pill d-inline-block fw-medium" [ngClass]="getUserTypeClass()">
              {{ getUserType() }}
            </span>
            <!-- Calificación (estática por ahora, puedes hacerla dinámica después) -->
            <div class="flex-align justify-content-center gap-8 mt-16">
              <div class="flex-align gap-4">
                <span class="text-xs fw-medium text-warning-600 d-flex"><i class="ph-fill ph-star"></i></span>
                <span class="text-xs fw-medium text-warning-600 d-flex"><i class="ph-fill ph-star"></i></span>
                <span class="text-xs fw-medium text-warning-600 d-flex"><i class="ph-fill ph-star"></i></span>
                <span class="text-xs fw-medium text-warning-600 d-flex"><i class="ph-fill ph-star"></i></span>
                <span class="text-xs fw-medium text-warning-600 d-flex"><i class="ph-fill ph-star"></i></span>
              </div>
              <span class="text-xs fw-medium text-gray-600">(4.9)</span>
            </div>
          </div>
        </div>

        <!-- ✅ Menú de navegación mejorado -->
        <div class="border border-gray-100 hover-border-main-600 rounded-16 overflow-hidden bg-white transition-2">
          <div class="p-16 bg-main-50 border-bottom border-gray-100">
            <h6 class="mb-0 text-main-600 fw-semibold">
              <i class="ph ph-list me-8"></i>
              Menú de cuenta
            </h6>
          </div>
          
          <div class="p-0">
            <a href="#" class="d-flex align-items-center justify-content-between p-16 text-decoration-none border-bottom border-gray-100 hover-bg-main-50 transition-2 bg-main-50 border-start border-start-4 border-main-600">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-main-600 text-white rounded-circle flex-center text-sm">
                  <i class="ph-bold ph-map-pin"></i>
                </span>
                <span class="text-heading fw-medium">Direcciones</span>
              </div>
              <i class="ph-bold ph-caret-right text-main-600"></i>
            </a>
            
            <a href="#" class="d-flex align-items-center justify-content-between p-16 text-decoration-none border-bottom border-gray-100 hover-bg-main-50 transition-2">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-gray-100 text-gray-600 rounded-circle flex-center text-sm hover-bg-main-600 hover-text-white transition-2">
                  <i class="ph-bold ph-user-circle"></i>
                </span>
                <span class="text-gray-700 fw-medium hover-text-heading">Reclamos</span>
              </div>
              <i class="ph-bold ph-caret-right text-gray-400"></i>
            </a>
            
            <a href="#" class="d-flex align-items-center justify-content-between p-16 text-decoration-none border-bottom border-gray-100 hover-bg-main-50 transition-2">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-gray-100 text-gray-600 rounded-circle flex-center text-sm hover-bg-main-600 hover-text-white transition-2">
                  <i class="ph-bold ph-package"></i>
                </span>
                <span class="text-gray-700 fw-medium hover-text-heading">Mis compras</span>
              </div>
              <i class="ph-bold ph-caret-right text-gray-400"></i>
            </a>
            
            <a href="#" class="d-flex align-items-center justify-content-between p-16 text-decoration-none border-bottom border-gray-100 hover-bg-main-50 transition-2">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-gray-100 text-gray-600 rounded-circle flex-center text-sm hover-bg-main-600 hover-text-white transition-2">
                  <i class="ph-bold ph-credit-card"></i>
                </span>
                <span class="text-gray-700 fw-medium hover-text-heading">Medios de pago</span>
              </div>
              <i class="ph-bold ph-caret-right text-gray-400"></i>
            </a>
            
            <a href="#" class="d-flex align-items-center justify-content-between p-16 text-decoration-none border-bottom border-gray-100 hover-bg-main-50 transition-2">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-gray-100 text-gray-600 rounded-circle flex-center text-sm hover-bg-main-600 hover-text-white transition-2">
                  <i class="ph-bold ph-heart"></i>
                </span>
                <span class="text-gray-700 fw-medium hover-text-heading">Mis listas</span>
              </div>
              <i class="ph-bold ph-caret-right text-gray-400"></i>
            </a>
            
            <a href="#" class="d-flex align-items-center justify-content-between p-16 text-decoration-none border-bottom border-gray-100 hover-bg-main-50 transition-2">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-gray-100 text-gray-600 rounded-circle flex-center text-sm hover-bg-main-600 hover-text-white transition-2">
                  <i class="ph-bold ph-gear"></i>
                </span>
                <span class="text-gray-700 fw-medium hover-text-heading">Configurar mi cuenta</span>
              </div>
              <i class="ph-bold ph-caret-right text-gray-400"></i>
            </a>
            
            <!-- Cerrar sesión con funcionalidad -->
            <a href="#" (click)="onLogout(); $event.preventDefault()" class="d-flex align-items-center justify-content-between p-16 text-decoration-none hover-bg-danger-50 transition-2">
              <div class="flex-align gap-12">
                <span class="w-32 h-32 bg-gray-100 text-gray-600 rounded-circle flex-center text-sm hover-bg-danger-600 hover-text-white transition-2">
                  <i class="ph-bold ph-sign-out"></i>
                </span>
                <span class="text-gray-700 fw-medium hover-text-danger-600">Cerrar sesión</span>
              </div>
              <i class="ph-bold ph-caret-right text-gray-400 hover-text-danger-600"></i>
            </a>
          </div>
        </div>

        <!-- ✅ Estadísticas rápidas -->
        <div class="border border-gray-100 hover-border-main-600 rounded-16 overflow-hidden bg-white mt-24 transition-2">
          <div class="p-16 bg-main-50 border-bottom border-gray-100">
            <h6 class="mb-0 text-main-600 fw-semibold">
              <i class="ph ph-chart-bar me-8"></i>
              Resumen de cuenta
            </h6>
          </div>
          <div class="p-20">
            <div class="row g-16">
              <div class="col-6">
                <div class="text-center">
                  <div class="w-40 h-40 bg-success-50 text-success-600 rounded-circle flex-center mx-auto mb-8">
                    <i class="ph-bold ph-shopping-bag text-lg"></i>
                  </div>
                  <h6 class="mb-4 text-heading">{{ direcciones.length }}</h6>
                  <span class="text-xs text-gray-500">Direcciones</span>
                </div>
              </div>
              <div class="col-6">
                <div class="text-center">
                  <div class="w-40 h-40 bg-warning-50 text-warning-600 rounded-circle flex-center mx-auto mb-8">
                    <i class="ph-bold ph-heart text-lg"></i>
                  </div>
                  <h6 class="mb-4 text-heading">12</h6>
                  <span class="text-xs text-gray-500">Favoritos</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ CONTENIDO PRINCIPAL MEJORADO -->
      <div class="col-lg-9">
        <div class="border border-gray-100 hover-border-main-600 rounded-16 overflow-hidden bg-white transition-2">
          <!-- ✅ Header de la sección -->
          <div class="p-24 p-md-32 border-bottom border-gray-100 bg-main-50">
            <div class="flex-between align-items-center gap-16 flex-wrap">
              <div class="flex-align gap-16">
                <div class="w-48 h-48 bg-main-600 text-white rounded-circle flex-center">
                  <i class="ph-bold ph-map-pin text-xl"></i>
                </div>
                <div>
                  <h4 class="mb-4 text-heading">Direcciones</h4>
                  <p class="text-gray-500 mb-0 text-sm">Gestiona tus direcciones de envío</p>
                </div>
              </div>
              <button (click)="abrirModal('create')" 
                      class="btn bg-main-600 hover-bg-main-800 text-white rounded-pill px-24 py-12 flex-align gap-8 transition-2">
                <i class="ph-bold ph-plus"></i>
                <span>Agregar dirección</span>
              </button>
            </div>
          </div>
          
          <!-- ✅ Contenido de direcciones dinámico -->
          <div class="p-24 p-md-32">
            <!-- Loading state -->
            <div *ngIf="isLoadingDirecciones" class="text-center py-40">
              <div class="spinner-border text-main-600" role="status">
                <span class="visually-hidden">Cargando direcciones...</span>
              </div>
            </div>

            <!-- Lista de direcciones -->
            <div *ngIf="!isLoadingDirecciones && direcciones.length > 0">
              <div *ngFor="let direccion of direcciones" 
                   class="border border-gray-100 hover-border-main-600 rounded-16 p-20 flex-between align-items-center gap-16 transition-2 hover-shadow-sm mb-16">
                
                <div class="flex-align gap-16 flex-grow-1">
                  <!-- Indicador de dirección principal -->
                  <div class="flex-shrink-0">
                    <div class="w-40 h-40 rounded-circle flex-center" 
                         [ngClass]="direccion.predeterminada ? 'bg-warning-50 text-warning-600' : 'bg-main-50 text-main-600'">
                      <i [class]="direccion.predeterminada ? 'ph-fill ph-star text-lg' : 'ph ph-map-pin text-lg'"></i>
                    </div>
                  </div>
                  
                  <!-- Información de la dirección -->
                  <div class="flex-grow-1">
                    <div class="flex-align gap-12 mb-8">
                      <h6 class="mb-0 text-heading">{{ direccion.nombre_destinatario }}</h6>
                      <span *ngIf="direccion.predeterminada" 
                            class="bg-success-50 text-success-600 px-8 py-2 rounded-pill text-xs fw-medium">
                        Principal
                      </span>
                      <span *ngIf="!direccion.predeterminada" 
                            class="bg-gray-100 text-gray-600 px-8 py-2 rounded-pill text-xs fw-medium">
                        Secundaria
                      </span>
                    </div>
                    <p class="text-gray-700 mb-4 text-sm line-height-1-4">
                      {{ direccion.direccion_completa }}
                    </p>
                    <div class="flex-align gap-16 text-xs text-gray-500">
                      <span class="flex-align gap-4" *ngIf="direccion.ubigeo">
                        <i class="ph ph-map-pin"></i>
                        {{ direccion.ubigeo.distrito }}, {{ direccion.ubigeo.provincia }}, {{ direccion.ubigeo.departamento }}
                      </span>
                      <span class="flex-align gap-4" *ngIf="direccion.telefono">
                        <i class="ph ph-phone"></i>
                        {{ direccion.telefono }}
                      </span>
                    </div>
                  </div>
                </div>
                
                <!-- Acciones -->
                <div class="flex-align gap-8 flex-shrink-0">
                  <button *ngIf="!direccion.predeterminada" 
                          (click)="establecerPredeterminada(direccion)"
                          class="w-40 h-40 bg-warning-50 text-warning-600 hover-bg-warning-600 hover-text-white rounded-circle flex-center transition-2" 
                          title="Establecer como principal">
                    <i class="ph-bold ph-star"></i>
                  </button>
                  <button (click)="abrirModal('edit', direccion)"
                          class="w-40 h-40 bg-main-50 text-main-600 hover-bg-main-600 hover-text-white rounded-circle flex-center transition-2" 
                          title="Editar dirección">
                    <i class="ph-bold ph-pencil-simple"></i>
                  </button>
                  <button (click)="eliminarDireccion(direccion)"
                          class="w-40 h-40 bg-danger-50 text-danger-600 hover-bg-danger-600 hover-text-white rounded-circle flex-center transition-2" 
                          title="Eliminar dirección">
                    <i class="ph-bold ph-trash"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Estado vacío -->
            <div *ngIf="!isLoadingDirecciones && direcciones.length === 0" class="text-center py-60">
              <div class="w-80 h-80 bg-gray-100 rounded-circle flex-center mx-auto mb-24">
                <i class="ph ph-map-pin text-4xl text-gray-400"></i>
              </div>
              <h6 class="text-gray-500 mb-12">No tienes direcciones guardadas</h6>
              <p class="text-gray-400 text-sm mb-24 max-w-300 mx-auto">
                Agrega una dirección para facilitar tus compras y entregas
              </p>
              <button (click)="abrirModal('create')" 
                      class="btn bg-main-600 hover-bg-main-800 text-white rounded-pill px-32 py-12 flex-align gap-8 mx-auto transition-2">
                <i class="ph-bold ph-plus"></i>
                <span>Agregar primera dirección</span>
              </button>
            </div>

            <!-- ✅ Información adicional -->
            <div class="mt-32 p-20 bg-color-one rounded-12">
              <div class="flex-align gap-16 mb-16">
                <div class="w-32 h-32 bg-main-600 text-white rounded-circle flex-center flex-shrink-0">
                  <i class="ph ph-info text-sm"></i>
                </div>
                <h6 class="mb-0 text-heading">Información importante</h6>
              </div>
              <ul class="list-inside ms-48">
                <li class="text-gray-700 text-sm mb-8">
                  <i class="ph ph-check text-success-600 me-8"></i>
                  Puedes tener hasta 10 direcciones guardadas
                </li>
                <li class="text-gray-700 text-sm mb-8">
                  <i class="ph ph-check text-success-600 me-8"></i>
                  La dirección principal se usará por defecto en tus compras
                </li>
                <li class="text-gray-700 text-sm mb-0">
                  <i class="ph ph-check text-success-600 me-8"></i>
                  Verifica que la información esté completa para evitar problemas de entrega
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mensaje cuando no hay usuario logueado -->
<div *ngIf="!isLoading && !currentUser" class="text-center py-80">
  <div class="container">
    <h5 class="text-gray-500 mb-16">Debes iniciar sesión para acceder a tu cuenta</h5>
    <a routerLink="/account" class="btn btn-main">Iniciar Sesión</a>
  </div>
</div>
<!-- ========================= My Account Section End =============================== -->

<!-- ========================== Shipping Section Start ============================ -->
<div class="shipping py-80">
  <div class="container container-lg">
    <div class="row gy-4">
      <div class="col-xxl-3 col-sm-6">
        <div class="shipping-item flex-align gap-16 rounded-16 bg-main-50 hover-bg-main-100 transition-2 p-24">
          <span class="w-56 h-56 flex-center rounded-circle bg-main-600 text-white text-2xl flex-shrink-0">
            <i class="ph-fill ph-truck"></i>
          </span>
          <div class="">
            <h6 class="mb-8">Envío gratis</h6>
            <span class="text-sm text-gray-500">En compras mayores a S/ 100</span>
          </div>
        </div>
      </div>
      <div class="col-xxl-3 col-sm-6">
        <div class="shipping-item flex-align gap-16 rounded-16 bg-main-50 hover-bg-main-100 transition-2 p-24">
          <span class="w-56 h-56 flex-center rounded-circle bg-main-600 text-white text-2xl flex-shrink-0">
            <i class="ph-fill ph-headset"></i>
          </span>
          <div class="">
            <h6 class="mb-8">Soporte 24/7</h6>
            <span class="text-sm text-gray-500">Atención al cliente</span>
          </div>
        </div>
      </div>
      <div class="col-xxl-3 col-sm-6">
        <div class="shipping-item flex-align gap-16 rounded-16 bg-main-50 hover-bg-main-100 transition-2 p-24">
          <span class="w-56 h-56 flex-center rounded-circle bg-main-600 text-white text-2xl flex-shrink-0">
            <i class="ph-fill ph-credit-card"></i>
          </span>
          <div class="">
            <h6 class="mb-8">Pago seguro</h6>
            <span class="text-sm text-gray-500">100% protegido</span>
          </div>
        </div>
      </div>
      <div class="col-xxl-3 col-sm-6">
        <div class="shipping-item flex-align gap-16 rounded-16 bg-main-50 hover-bg-main-100 transition-2 p-24">
          <span class="w-56 h-56 flex-center rounded-circle bg-main-600 text-white text-2xl flex-shrink-0">
            <i class="ph-fill ph-arrow-clockwise"></i>
          </span>
          <div class="">
            <h6 class="mb-8">Devoluciones</h6>
            <span class="text-sm text-gray-500">30 días de garantía</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Modal de dirección -->
<app-modal-direccion
  [direccion]="direccionEditando"
  [departamentos]="departamentos"
  (direccionGuardada)="onDireccionGuardada()"
  (modalCerrado)="cerrarModal()">
</app-modal-direccion>
</div>
<!-- ========================== Shipping Section End ============================ -->