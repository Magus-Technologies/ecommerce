<!-- src\app\pages\index-two\index-two.component.html -->
<!-- ============================ Banner Section start =============================== -->
<app-breadcrumb title="Computadoras" subtitle="Pc"></app-breadcrumb>

<!-- =============================== Shop Section Start ======================================== -->
<section class="shop py-80">
  <div class="container container-lg">
    <div class="row">
      <!-- Sidebar Start -->
      <div class="col-lg-3">
        <div class="shop-sidebar">
          <button
            type="button"
            class="shop-sidebar__close d-lg-none d-flex w-32 h-32 flex-center border border-gray-100 rounded-circle hover-bg-main-600 position-absolute inset-inline-end-0 me-10 mt-8 hover-text-white hover-border-main-600"
          >
            <i class="ph ph-x"></i>
          </button>

          <!-- Categoría de producto - COPIADO DE SHOP CON ESPACIADO CORRECTO -->
          <div
            class="shop-sidebar__box border border-gray-100 rounded-8 p-32 mb-32"
          >
            <h6 class="text-xl border-bottom border-gray-100 pb-24 mb-24">
              Categoría de producto
            </h6>
            <ul class="max-h-540 overflow-y-auto scroll-sm">
              <!-- Opción para todas las categorías -->
              <li class="mb-24">
                <a
                  (click)="limpiarFiltros()"
                  class="text-gray-900 hover-text-main-600 cursor-pointer"
                  [class.fw-bold]="!categoriaSeleccionada"
                >
                  Todas las categorías ({{ totalProductos }})
                </a>
              </li>

              <!-- VOLVER A USAR CATEGORIES (SECCIÓN 1) EN LUGAR DE CATEGORIAS (TODAS) -->
              <li
                class="mb-24"
                *ngFor="let categoria of categories; let last = last"
                [ngClass]="{ 'mb-0': last }"
              >
                <a
                  (click)="seleccionarCategoria(categoria.id)"
                  class="text-gray-900 hover-text-main-600 cursor-pointer"
                  [class.fw-bold]="categoriaSeleccionada === categoria.id"
                >
                  {{ categoria.nombre }} ({{ categoria.productos_count }})
                </a>
              </li>
            </ul>
          </div>

          <!-- Filtros usando componente reutilizable -->
          <app-product-filter 
            [categories]="categories" 
            [marcas]="marcas" 
            (filtersApplied)="onFiltersApplied($event)">
          </app-product-filter>

          <!-- Filtrar por marca - CON ESPACIADO CORRECTO COMO SHOP -->
          <div
            class="shop-sidebar__box border border-gray-100 rounded-8 p-32 mb-32"
          >
            <h6 class="text-xl border-bottom border-gray-100 pb-24 mb-24">
              Filtrar por marca
            </h6>
            <ul class="max-h-540 overflow-y-auto scroll-sm">
              <li *ngFor="let marca of marcas" class="mb-24">
                <div class="form-check common-check common-radio">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="marca"
                    [id]="'marca-' + marca.id"
                    [checked]="marcaSeleccionada === marca.id"
                    (change)="seleccionarMarca(marca.id)"
                  />
                  <label class="form-check-label" [for]="'marca-' + marca.id">{{
                    marca.nombre
                  }}</label>
                </div>
              </li>
            </ul>
          </div>

          <!-- Banner dinámico del sidebar - CON ESPACIADO CORRECTO -->
          <div
            *ngIf="bannerSidebar"
            class="shop-sidebar__box rounded-8 overflow-hidden"
          >
            <a [href]="bannerSidebar.enlace_url" class="d-block">
              <img
                [src]="bannerSidebar.imagen_url"
                [alt]="bannerSidebar.titulo"
                class="w-100"
                style="object-fit: cover"
              />
            </a>
          </div>
        </div>
      </div>
      <!-- Sidebar End -->

      <!-- Content Start -->
      <div class="col-lg-9">
        <!-- Top Start -->
        <div class="flex-between gap-16 flex-wrap mb-40">
          <span class="text-gray-900">
            Mostrando {{ productos.length }} de {{ totalProductos }} resultados
          </span>
        </div>
        <!-- Top End -->

        <!-- Loading -->
        <div *ngIf="productosLoading" class="text-center py-5 w-100">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>

        <!-- Mensaje si no hay productos -->
        <div
          *ngIf="!productosLoading && productos.length === 0"
          class="text-center py-5 w-100"
        >
          <h5>No se encontraron productos</h5>
          <p class="text-muted">Intenta con otra categoría o marca</p>
        </div>

        <!-- Contenedor de productos con layout dinámico -->
        <div
          *ngIf="!productosLoading && productos.length > 0"
          class="list-grid-wrapper"
          [ngClass]="{
            'list-view': listview === 'list',
            'grid-view': listview === 'grid'
          }"
        >
          <div
            *ngFor="let producto of productos"
            class="product-card p-16 border border-gray-100 hover-border-main-600 rounded-16 position-relative transition-2"
            [class.h-100]="listview === 'grid'"
          >
            <a
              [routerLink]="['/product-details', producto.id]"
              class="product-card__thumb flex-center rounded-8 position-relative"
            >
              <img
                [src]="producto.imagen_principal"
                [alt]="producto.nombre"
                (error)="onImageError($event)"
                loading="lazy"
                class="product-image"
              />

              <span
                *ngIf="producto.is_on_sale"
                class="product-card__badge bg-danger-600 px-8 py-4 text-sm text-white position-absolute inset-inline-start-0 inset-block-start-0"
              >
                Sale {{ producto.discount_percentage }}%
              </span>
            </a>

            <div class="product-card__content mt-16">
              <h6 class="title text-lg fw-semibold mt-12 mb-8">
                <a
                  [routerLink]="['/product-details', producto.id]"
                  class="link text-line-2"
                >
                  {{ producto.nombre }}
                </a>
              </h6>

              <div class="flex-align mb-20 mt-16 gap-6">
                <span class="text-xs fw-medium text-gray-500">{{
                  producto.rating
                }}</span>
                <span class="text-xs fw-medium text-warning-600 d-flex">
                  <i class="ph-fill ph-star"></i>
                </span>
                <span class="text-xs fw-medium text-gray-500"
                  >({{ producto.total_reviews }})</span
                >
              </div>

              <div class="mt-8">
                <div
                  class="progress w-100 bg-color-three rounded-pill h-4"
                  role="progressbar"
                  [attr.aria-valuenow]="
                    (producto.sold_count / producto.total_stock) * 100
                  "
                  aria-valuemin="0"
                  aria-valuemax="100"
                >
                  <div
                    class="progress-bar bg-main-two-600 rounded-pill"
                    [style.width.%]="
                      (producto.sold_count / producto.total_stock) * 100
                    "
                  ></div>
                </div>
                <span class="text-gray-900 text-xs fw-medium mt-8">
                  Sold: {{ producto.sold_count }}/{{ producto.total_stock }}
                </span>
              </div>

              <div class="product-card__price my-20">
                <span
                  *ngIf="producto.precio_oferta"
                  class="text-gray-400 text-md fw-semibold text-decoration-line-through"
                >
                  S/ {{ producto.precio }}
                </span>
                <span class="text-heading text-md fw-semibold">
                  S/ {{ producto.precio_oferta || producto.precio }}
                  <span class="text-gray-500 fw-normal">/Qty</span>
                </span>
              </div>

              <!-- ✅ BOTÓN IGUAL QUE INDEX - CENTRADO -->
              <button
                (click)="addToCart(producto)"
                [disabled]="producto.stock <= 0"
                class="product-card__cart btn bg-main-50 text-main-600 hover-bg-main-600 hover-text-white py-11 px-24 rounded-pill flex-align gap-8 mt-24 w-100 justify-content-center"
                [ngClass]="{
                  'bg-main-50 text-main-600 hover-bg-main-600 hover-text-white':
                    producto.stock > 0,
                  'bg-gray-200 text-gray-500': producto.stock <= 0
                }"
              >
                <span *ngIf="producto.stock > 0">
                  Agregar al carrito <i class="ph ph-shopping-cart"></i>
                </span>
                <span *ngIf="producto.stock <= 0">
                  Sin stock <i class="ph ph-x-circle"></i>
                </span>
              </button>
            </div>
          </div>
        </div>

        <!-- Paginación -->
        <ul class="pagination flex-center flex-wrap gap-16">
          <li class="page-item">
            <a
              class="page-link h-64 w-64 flex-center text-xxl rounded-8 fw-medium text-neutral-600 border border-gray-100"
              href="#"
              (click)="onPageChange(currentPage - 1)"
              [class.disabled]="currentPage === 1"
            >
              <i class="ph-bold ph-arrow-left"></i>
            </a>
          </li>

          <!-- Loop through the pages dynamically -->
          <li
            *ngFor="let page of getPages()"
            class="page-item"
            [class.active]="page === currentPage"
          >
            <a
              class="page-link h-64 w-64 flex-center text-md rounded-8 fw-medium text-neutral-600 border border-gray-100"
              href="#"
              (click)="onPageChange(page)"
            >
              {{ page < 10 ? "0" + page : page }}
            </a>
          </li>

          <li class="page-item">
            <a
              class="page-link h-64 w-64 flex-center text-xxl rounded-8 fw-medium text-neutral-600 border border-gray-100"
              href="#"
              (click)="onPageChange(currentPage + 1)"
              [class.disabled]="currentPage === totalPages"
            >
              <i class="ph-bold ph-arrow-right"></i>
            </a>
          </li>
        </ul>
      </div>
      <!-- Content End -->
    </div>
    <!-- Content End -->
  </div>
</section>
<!-- =============================== Shop Section End ======================================== -->
